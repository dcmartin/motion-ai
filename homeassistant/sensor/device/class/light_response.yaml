###
# homeassistant/sensor/device/class/light_response.yaml
###

- platform: template
  sensors:
    motion_device_light_approve:
      value_template: >-
        {%- set response = 'approve' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_light','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_light_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_light_deny:
      value_template: >-
        {%- set response = 'deny' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_light','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_light_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_light_wait:
      value_template: >-
        {%- set response = 'wait' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_light','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_light_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_light_help:
      value_template: >-
        {%- set response = 'help' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_light','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_light_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
