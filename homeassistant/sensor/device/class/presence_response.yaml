###
# homeassistant/sensor/device/class/presence_response.yaml
###

- platform: template
  sensors:
    motion_device_presence_approve:
      value_template: >-
        {%- set response = 'approve' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_presence','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_presence_alarm_exist','actions') -%}
          {%- if s|lower != 'none' -%}
            {% set actions = s %}
            {% set s = actions|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
              {% set action = s|first %}
              {% set s = action.actions|selectattr('id','==',response)|list %}
              {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
                {% set state = (s|first).title %}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_presence_deny:
      value_template: >-
        {%- set response = 'deny' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_presence','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_presence_alarm_exist','actions') -%}
          {%- if s|lower != 'none' -%}
            {% set actions = s %}
            {% set s = actions|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
              {% set action = s|first %}
              {% set s = action.actions|selectattr('id','==',response)|list %}
              {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
                {% set state = (s|first).title %}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_presence_wait:
      value_template: >-
        {%- set response = 'wait' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_presence','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_presence_alarm_exist','actions') -%}
          {%- if s|lower != 'none' -%}
            {% set actions = s %}
            {% set s = actions|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
              {% set action = s|first %}
              {% set s = action.actions|selectattr('id','==',response)|list %}
              {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
                {% set state = (s|first).title %}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_presence_help:
      value_template: >-
        {%- set response = 'help' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_presence','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_presence_alarm_exist','actions') -%}
          {%- if s|lower != 'none' -%}
            {% set actions = s %}
            {% set s = actions|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
              {% set action = s|first %}
              {% set s = action.actions|selectattr('id','==',response)|list %}
              {% if s|lower != 'none' and not action is string and action is iterable and s|count > 0 %}
                {% set state = (s|first).title %}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
