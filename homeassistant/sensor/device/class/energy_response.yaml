###
# homeassistant/sensor/device/class/energy_response.yaml
###

- platform: template
  sensors:
    motion_device_energy_approve:
      attribute_templates:
        function: >-
          {%- set function = none -%}
          {%- set response = 'approve' -%}
          {%- set s = state_attr('binary_sensor.motion_device_humidity','condition') -%}
          {%- if s|lower != 'none' -%}
            {% set condition = s|string -%}
            {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
            {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
              {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
              {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                {% set s = s|first %}
                {% if s|lower != 'none' and 'actions' in s %}
                  {% set s = s.actions %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|selectattr('id','==',response)|list %}
                    {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                      {% set s = s|first %}
                      {% set function = s.trigger|default(none) %}
                    {%- endif -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
          {{- function -}}
      value_template: >-
        {%- set response = 'approve' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_energy','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_energy_deny:
      attribute_templates:
        function: >-
          {%- set function = none -%}
          {%- set response = 'deny' -%}
          {%- set s = state_attr('binary_sensor.motion_device_humidity','condition') -%}
          {%- if s|lower != 'none' -%}
            {% set condition = s|string -%}
            {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
            {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
              {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
              {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                {% set s = s|first %}
                {% if s|lower != 'none' and 'actions' in s %}
                  {% set s = s.actions %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|selectattr('id','==',response)|list %}
                    {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                      {% set s = s|first %}
                      {% set function = s.trigger|default(none) %}
                    {%- endif -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
          {{- function -}}
      value_template: >-
        {%- set response = 'deny' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_energy','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_energy_wait:
      attribute_templates:
        function: >-
          {%- set function = none -%}
          {%- set response = 'wait' -%}
          {%- set s = state_attr('binary_sensor.motion_device_humidity','condition') -%}
          {%- if s|lower != 'none' -%}
            {% set condition = s|string -%}
            {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
            {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
              {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
              {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                {% set s = s|first %}
                {% if s|lower != 'none' and 'actions' in s %}
                  {% set s = s.actions %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|selectattr('id','==',response)|list %}
                    {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                      {% set s = s|first %}
                      {% set function = s.trigger|default(none) %}
                    {%- endif -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
          {{- function -}}
      value_template: >-
        {%- set response = 'wait' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_energy','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
    motion_device_energy_help:
      attribute_templates:
        function: >-
          {%- set function = none -%}
          {%- set response = 'help' -%}
          {%- set s = state_attr('binary_sensor.motion_device_humidity','condition') -%}
          {%- if s|lower != 'none' -%}
            {% set condition = s|string -%}
            {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
            {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
              {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
              {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                {% set s = s|first %}
                {% if s|lower != 'none' and 'actions' in s %}
                  {% set s = s.actions %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|selectattr('id','==',response)|list %}
                    {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                      {% set s = s|first %}
                      {% set function = s.trigger|default(none) %}
                    {%- endif -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
          {{- function -}}
      value_template: >-
        {%- set response = 'help' -%}
        {%- set state = none -%}
        {%- set s = state_attr('binary_sensor.motion_device_energy','condition') -%}
        {%- if s|lower != 'none' -%}
          {% set condition = s|string -%}
          {% set s = state_attr('binary_sensor.motion_device_energy_alarm_exist','actions') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable and s|count > 0 -%}
            {% set s = s|selectattr('id','defined')|selectattr('id','search',condition)|list %}
            {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
              {% set s = s|first %}
              {% if s|lower != 'none' and 'actions' in s %}
                {% set s = s.actions %}
                {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                  {% set s = s|selectattr('id','==',response)|list %}
                  {% if s|lower != 'none' and not s is string and s is iterable and s|count > 0 %}
                    {% set s = s|first %}
                    {% set state = s.title %}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
        {{- state -}}
