###
# homeassistant/sensor/plex.yaml
###

- platform: template
  sensors:
    plex:
      icon: 'mdi:plex'
      friendly_name: Plex server
      attribute_templates:
        watching: >-
          {% set plex = states('sensor.plex') %}
          {{ states('sensor.plex_' + plex) }}
        now_playing: >-
          {% set plex = states('sensor.plex') %}
          {{ state_attr('sensor.plex_' + plex,plex + ' - Plex Media Player') }}
        movies: >-
          {% set plex = states('sensor.plex') %}
          {{ states('sensor.' + plex + '_library_movies') }}
        episodes: >-
          {% set plex = states('sensor.plex') %}
          {{ states('sensor.' + plex + '_library_tv_shows') }}
        shows: >-
          {% set plex = states('sensor.plex') %}
          {{ state_attr('sensor.' + plex + '_library_tv_shows','shows') }}
      value_template: >-
        {% for state in states.sensor if 'plex' in state.entity_id -%}
          {%- if loop.first -%}
            {{- state.entity_id|string|replace('sensor.plex_','') -}}
          {%- endif -%}
        {%- endfor %}
