###
## homeassistant/sensor/uptime.yaml
###

- platform: uptime

- platform: template
  sensors:
    uptime_ago:
      friendly_name:  'Ago (s)'
      unit_of_measurement: 's'
      value_template: >-
        {%- set s = states('sensor.uptime') %}
        {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
          {{- (utcnow().timestamp() - as_timestamp(s)|float(0.0))|round -}}
        {%- else -%}null{%- endif -%}
    uptime_relative:
      friendly_name:  'Uptime'
      value_template: >-
        {%- set t = utcnow() -%}
        {%- set s = states('sensor.uptime') -%}
        {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
          {%- set r = as_datetime(s|float(0.0)) -%}
          {{- relative_time(r) -}}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: uptime_ago_mean
  entity_id: sensor.uptime_ago
  state_characteristic: mean
  sampling_size: 100
  max_age:
    hours: 24
