###
## homeassistant/sensor/uptime.yaml
###

- platform: uptime

- platform: template
  sensors:
    uptime_ago:
      friendly_name:  'Uptime ago (s)'
      unit_of_measurement: 's'
      value_template: >-
        {%- set s = states('sensor.uptime') %}
        {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
          {{- (utcnow().timestamp() - as_timestamp(s)|float(0.0))|round -}}
        {%- else -%}null{%- endif -%}
    uptime_relative:
      friendly_name:  'Uptime relative'
      value_template: >-
        {%- set t = utcnow() -%}
        {%- set s = states('sensor.uptime') -%}
        {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
          {{ relative_time(s|as_datetime) }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: uptime_ago_mean
  entity_id: sensor.uptime_ago
  state_characteristic: mean
  sampling_size: 100
  max_age:
    hours: 24

- platform: template
  sensors:
    motion_uptime:
      friendly_name: 'Uptime'
      unit_of_measurement: 's'
      attribute_templates:
        friendly_name: >-
          {{ states('sensor.motion_name')|string + ' uptime' }}
        ago: >-
          {%- set s = states('sensor.uptime') %}
          {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
            {{- (utcnow().timestamp() - as_timestamp(s)|float(0.0))|round -}}
          {%- else -%}null{%- endif -%}
        relative: >-
          {%- set t = utcnow() -%}
          {%- set s = states('sensor.uptime') -%}
          {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' -%}
            {{ relative_time(s|as_datetime) }}
          {%- else -%}null{%- endif -%}
        mean: >-
          {{ states('sensor.uptime_ago_mean') }}
      value_template: >-
        {{ states('sensor.uptime') }}
