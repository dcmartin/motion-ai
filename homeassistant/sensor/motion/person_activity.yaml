###
# homeassistant/sensor/motion/person_activity.yaml
###

#    Stationary
#    Walking
#    Running
#    Automotive
#    Cycling

- platform: template
  sensors:
    motion_person_stationary_ratio_1d:
      friendly_name: 'Stationary (1d)'
      icon_template: 'mdi:sofa'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_stationary_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_walking_ratio_1d:
      friendly_name: 'Walking (1d)'
      icon_template: 'mdi:walk'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_walking_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_running_ratio_1d:
      friendly_name: 'Running (1d)'
      icon_template: 'mdi:run'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_running_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_automotive_ratio_1d:
      friendly_name: 'Automotive (1d)'
      icon_template: 'mdi:car'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_automotive_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_cycling_ratio_1d:
      friendly_name: 'Cycling (1d)'
      icon_template: 'mdi:bicycle'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_cycling_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_stationary_ratio_1w:
      friendly_name: 'Stationary (1w)'
      icon_template: 'mdi:sofa'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_stationary_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_walking_ratio_1w:
      friendly_name: 'Walking (1w)'
      icon_template: 'mdi:walk'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_walking_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_running_ratio_1w:
      friendly_name: 'Running (1w)'
      icon_template: 'mdi:run'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_running_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_automotive_ratio_1w:
      friendly_name: 'Automotive (1w)'
      icon_template: 'mdi:car'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_automotive_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_cycling_ratio_1w:
      friendly_name: 'Cycling (1w)'
      icon_template: 'mdi:bicycle'
      unit_of_measurement: '📱%'
      value_template: >
        {%- set s = states('sensor.motion_person_cycling_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}

## today

- platform: history_stats
  name: motion_person_stationary_ratio_history_stats_1d
  entity_id: sensor.motion_person_device_activity
  state: 'Stationary'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_cycling_ratio_history_stats_1d
  entity_id: sensor.motion_person_device_activity
  state: 'Cycling'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_running_ratio_history_stats_1d
  entity_id: sensor.motion_person_device_activity
  state: 'Running'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_automotive_ratio_history_stats_1d
  entity_id: sensor.motion_person_device_activity
  state: 'Automotive'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_walking_ratio_history_stats_1d
  entity_id: sensor.motion_person_device_activity
  state: 'Walking'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

## weeks

- platform: history_stats
  name: motion_person_stationary_ratio_history_stats_1w
  entity_id: sensor.motion_person_device_activity
  state: 'Stationary'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_cycling_ratio_history_stats_1w
  entity_id: sensor.motion_person_device_activity
  state: 'Cycling'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_running_ratio_history_stats_1w
  entity_id: sensor.motion_person_device_activity
  state: 'Running'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_automotive_ratio_history_stats_1w
  entity_id: sensor.motion_person_device_activity
  state: 'Automotive'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_walking_ratio_history_stats_1w
  entity_id: sensor.motion_person_device_activity
  state: 'Walking'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

##
# home ratio
##

- platform: history_stats
  name: motion_person_home_ratio_history_stats_1d
  entity_id: binary_sensor.motion_person_home
  state: 'on'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_home_ratio_history_stats_1w
  entity_id: binary_sensor.motion_person_home
  state: 'on'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: statistics
  name: motion_person_home_ratio_statistics_1w
  entity_id: sensor.motion_person_home_ratio_history_stats_1d
  sampling_size: 500
  max_age:
    hours: 168

- platform: template
  sensors:
    motion_person_home_ratio_1d:
      friendly_name: 'Home ratio (1d)'
      icon_template: 'mdi:home-variant'
      unit_of_measurement: '🏠%'
      value_template: >
        {%- set s = states('sensor.motion_person_home_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_home_ratio_1w:
      friendly_name: 'Home ratio (1w)'
      icon_template: 'mdi:home-variant'
      unit_of_measurement: '🏠%'
      value_template: >
        {%- set s = states('sensor.motion_person_home_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}

- platform: template
  sensors:
    motion_person_home_ratio_mean_1w:
      friendly_name: 'Person home ratio μ (1w)'
      unit_of_measurement: '🏠%'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_home_ratio_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_home_ratio_statistics_1w.state|float }}
        {%- else -%}null{%- endif -%}
    motion_person_home_ratio_min_1w:
      friendly_name: 'Person home ratio  min (1w)'
      unit_of_measurement: '🏠%'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_home_ratio_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_home_ratio_statistics_1w.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_person_home_ratio_max_1w:
      friendly_name: 'Person home ratio  max (1w)'
      unit_of_measurement: '🏠%'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_home_ratio_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_home_ratio_statistics_1w.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_person_home_ratio_stdev_1w:
      friendly_name: Person home ratio  stdev (1w)
      unit_of_measurement: '🏠%'
      icon_template: 'mdi:sigma-lower'
      value_template: >
        {% if states('sensor.motion_person_home_ratio_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_home_ratio_statistics_1w.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_person_home_ratio_change_1w:
      friendly_name: Person home ratio  change (1w)
      unit_of_measurement: '🏠%'
      icon_template: 'mdi:hike'
      value_template: >
        {% if states('sensor.motion_person_home_ratio_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_home_ratio_statistics_1w.attributes.change|float }}
        {%- else -%}null{%- endif -%}

##
# away count
##

- platform: history_stats
  name: motion_person_away_count_history_stats_1d
  entity_id: binary_sensor.motion_person_home
  state: 'off'
  type: count
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: motion_person_away_count_history_stats_1w
  entity_id: binary_sensor.motion_person_home
  state: 'off'
  type: count
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'

- platform: statistics
  name: motion_person_away_count_statistics_1w
  entity_id: sensor.motion_person_away_count_count_history_stats_1d
  sampling_size: 500
  max_age:
    hours: 168

- platform: template
  sensors:
    motion_person_away_count_1d:
      friendly_name: 'Away count (1d)'
      icon_template: 'mdi:map'
      unit_of_measurement: '🗺'
      value_template: >
        {%- set s = states('sensor.motion_person_away_count_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|int -}}
        {%- else -%}null{%- endif -%}
    motion_person_away_count_1w:
      friendly_name: 'Away count (1w)'
      icon_template: 'mdi:map'
      unit_of_measurement: '🗺'
      value_template: >
        {%- set s = states('sensor.motion_person_away_count_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|int -}}
        {%- else -%}null{%- endif -%}

- platform: template
  sensors:
    motion_person_away_count_mean_1w:
      friendly_name: 'Person away μ (1w)'
      unit_of_measurement: '🗺'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_away_count_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_away_count_statistics_1w.state|float }}
        {%- else -%}null{%- endif -%}
    motion_person_away_count_min_1w:
      friendly_name: 'Person away min (1w)'
      unit_of_measurement: '🗺'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_away_count_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_away_count_statistics_1w.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_person_away_count_max_1w:
      friendly_name: 'Person away max (1w)'
      unit_of_measurement: '🗺'
      icon_template: 'mdi:hike'
      value_template: >-
        {% if states('sensor.motion_person_away_count_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_away_count_statistics_1w.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_person_away_count_stdev_1w:
      friendly_name: Person away stdev (1w)
      unit_of_measurement: '🗺'
      icon_template: 'mdi:sigma-lower'
      value_template: >
        {% if states('sensor.motion_person_away_count_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_away_count_statistics_1w.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_person_away_count_change_1w:
      friendly_name: Person away change (1w)
      unit_of_measurement: '🗺'
      icon_template: 'mdi:hike'
      value_template: >
        {% if states('sensor.motion_person_away_count_statistics_1w') != 'unknown' %}
          {{ states.sensor.motion_person_away_count_statistics_1w.attributes.change|float }}
        {%- else -%}null{%- endif -%}

## interactive

- platform: template
  sensors:
    motion_person_smartphone_interactive_ratio_1d:
      friendly_name: 'In-Use (1d)'
      icon_template: 'mdi:account-voice'
      unit_of_measurement: '🗣%'
      value_template: >
        {%- set s = states('sensor.motion_person_smartphone_interactive_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_smartphone_interactive_ratio_1w:
      friendly_name: 'In-Use (1w)'
      icon_template: 'mdi:account-voice'
      unit_of_measurement: '🗣%'
      value_template: >
        {%- set s = states('sensor.motion_person_smartphone_interactive_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}

## today

- platform: history_stats
  name: motion_person_smartphone_interactive_ratio_history_stats_1d
  entity_id: binary_sensor.motion_person_smartphone_interactive
  state: 'on'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

## weeks

- platform: history_stats
  name: motion_person_smartphone_interactive_ratio_history_stats_1w
  entity_id: binary_sensor.motion_person_smartphone_interactive
  state: 'on'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'
 
## active

- platform: template
  sensors:
    motion_person_smartphone_active_ratio_1d:
      friendly_name: 'Active (1d)'
      icon_template: 'mdi:cellphone-information'
      unit_of_measurement: '🗣%'
      value_template: >
        {%- set s = states('sensor.motion_person_smartphone_active_ratio_history_stats_1d') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}
    motion_person_smartphone_active_ratio_1w:
      friendly_name: 'Active (1w)'
      icon_template: 'mdi:cellphone-information'
      unit_of_measurement: '🗣%'
      value_template: >
        {%- set s = states('sensor.motion_person_smartphone_active_ratio_history_stats_1w') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- s|float -}}
        {%- else -%}null{%- endif -%}

## today

- platform: history_stats
  name: motion_person_smartphone_active_ratio_history_stats_1d
  entity_id: binary_sensor.motion_person_smartphone_active
  state: 'on'
  type: ratio
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

## weeks

- platform: history_stats
  name: motion_person_smartphone_active_ratio_history_stats_1w
  entity_id: binary_sensor.motion_person_smartphone_active
  state: 'on'
  type: ratio
  start: >-
    {{ now().replace(hour=0).replace(minute=0).replace(second=0).timestamp()|int - states('sensor.motion_person_weeks_timestamp')|int }}
  end: '{{ now() }}'
