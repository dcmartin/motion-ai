###
# homeassistant/sensor/motion/smartphone.yaml
###

- platform: template
  sensors:
    motion_smartphone_name:
      unique_id: motion_smartphone_name
      friendly_name: Smartphone notify
      icon_template: >-
        {%- set s = states('input_select.motion_smartphone_name') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{- 'mdi:cellphone-link' -}}
        {%- else -%}
          {{- 'mdi:cellphone-link-off' -}}
        {%- endif -%}
      attribute_templates:
        sensor: >-
          {% for i in states.person if i.attributes.id == states('sensor.motion_person') %}
            {% if loop.first %}{{ i.entity_id }}{% endif %}
          {% endfor %}
      value_template: >
        {%- set s = states('input_select.motion_smartphone_name') -%}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{ s }}
        {%- else -%}{{- 'Pending' -}}{%- endif -%}
    motion_smartphone_location:
      unique_id: motion_smartphone_location
      friendly_name: 'Smartphone location'
      icon_template: >-
        {{ 'mdi:map-marker' }}
      value_template: >-
        {% set s = state_attr('sensor.motion_smartphone_name','sensor') %}
        {% if s|lower != 'unknown' and s|lower != 'none' and s|lower != 'unavailable' %}
          {{ states(s) }}
        {% else %}
          {% set s = states('sensor.motion_smartphone_location') %}
          {% if s|lower != 'unknown' and s|lower != 'none' and s|lower != 'unavailable' %}
            {{ s }}
          {% else %}
           {{ 'unknown' }}
          {% endif %}
        {% endif %}
