###
# homeassistant/sensor/feedparser.yaml
###

- platform: feedparser
  name: uptimerobot_feed
  feed_url: >-
    {{ state_attr('binary_sensor.uptimerobot_feed','rssurl') }}
  date_format: '%a, %b %d %I:%M %p'
  inclusions:
    - title
    - link
    - description
    - image
    - language
    - pubDate
    - details:duration
  exclusions:
    - language

- platform: template
  sensors:
    uptimerobot_link_up_percent:
      friendly_name: 'Uptime'
      icon_template: 'mdi:percent'
      unit_of_measurement: '%'
      value_template: >-
        {%- set s = state_attr('binary_sensor.uptimerobot_feed','link_up_count') -%}
        {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' and s|int(0) > 0 %}
          {%- set u = s|int(0) -%}
          {%- set s = state_attr('binary_sensor.uptimerobot_feed','link_down_count') -%}
          {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' and s|int(0) > 0 %}
            {%- set t = u + s|int(0) -%}
          {% else %}
            {% set t = u %}
          {% endif %}
          {{ '%0.1f'|format(u|float(0.0) / t|float(0.0) * 100.0) }}
        {% else %}null{% endif %}
