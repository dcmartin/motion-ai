###
# homeassistant/sensor/feedparser.yaml
###

-  platform: feedparser
   name: uptimerobot_feed
   feed_url: '!secret uptimerobot-rssurl'
   date_format: '%a, %b %d %I:%M %p'
   inclusions:
     - title
     - link
     - description
     - image
     - language
     - pubDate
   exclusions:
     - language

- platform: template
  sensors:
    uptimerobot_feed_count:
      friendly_name: 'Feed update (#)'
      icon_template: 'mdi:counter'
      value_template: >-
        {{ states('sensor.uptimerobot_feed')|int }}
    uptimerobot_link_down_count:
      friendly_name: 'Link down (#)'
      icon_template: 'mdi:counter'
      value_template: >-
        {%- set s = states('sensor.uptimerobot_link_down')|split(',')|list|length -%} 
    uptimerobot_link_down:
      value_template: >-
        {%- for i in state_attr('sensor.uptimerobot_feed','entries') if 'DOWN' in i.title -%} 
          {%- if not loop.first -%},{%- endif -%}
          {{- i.link -}}
        {%- endfor -%}
    uptimerobot_link_up_count:
      friendly_name: 'Link up (#)'
      icon_template: 'mdi:counter'
      value_template: >-
        {%- set s = states('sensor.uptimerobot_link_up')|split(',')|list|length -%} 
    uptimerobot_link_up:
      value_template: >-
        {%- for i in state_attr('sensor.uptimerobot_feed','entries') if 'UP' in i.title -%} 
          {%- if not loop.first -%},{%- endif -%}
          {{- i.link -}}
        {%- endfor -%}
    uptimerobot_link_down_nabucasa:
      friendly_name: 'NabuCasa link (down)'
      icon_template: 'mdi:lan-disconnect'
      value_template: >-
        {%- for i in state_attr('sensor.uptimerobot_feed','entries') if 'DOWN' in i.title and 'nabu.casa' in i.link -%} 
          {%- if not loop.first -%},{%- endif -%}
          {{- i.link -}}
        {%- endfor -%}
    uptimerobot_link_up_nabucasa:
      friendly_name: 'NabuCasa link (up)'
      icon_template: 'mdi:lan-connect'
      value_template: >-
        {%- for i in state_attr('sensor.uptimerobot_feed','entries') if 'UP' in i.title and 'nabu.casa' in i.link -%} 
          {%- if not loop.first -%},{%- endif -%}
          {{- i.link -}}
        {%- endfor -%}
