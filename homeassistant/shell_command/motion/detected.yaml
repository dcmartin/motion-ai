###
# homeassistant/automation/motion/detected.yaml
###

motion_detected_copy: >-
  {% set e = states('sensor.motion_event_annotated') %}
  {% set hd = states('sensor.motion_apache_htdocs') %}
  {% if e is not none and e|lower != 'unavailable' and e|lower != 'unknown' and e != 'null' 
       and hd is not none and e|lower != 'unavailable' and e|lower != 'unknown' and hd != 'null' %}
    {% set c = state_attr('sensor.motion_event_annotated','event').camera %}
    {% set id = state_attr('sensor.motion_event_annotated','event').id %}
    {% if c is not none and e|lower != 'unavailable' and e|lower != 'unknown' and c != 'null'
         and id is not none and e|lower != 'unavailable' and e|lower != 'unknown' and id != 'null' %}
      cp -f "/config/www/images/motion_annotated-{{- c -}}.jpg" "{{ hd -}}/cameras/motion_detected-{{- c -}}.jpg" && cp -f "/config/www/images/motion_annotated-{{- c -}}.gif" "{{ hd -}}/cameras/motion_detected-{{- c -}}.gif" && cp -f "{{ hd -}}/cameras/{{- c -}}/{{- id -}}.mp4" "{{ hd -}}/cameras/motion_detected-{{- c -}}.mp4"
    {% endif %}
  {% endif %}
