###
## homeassistant/binary_sensor/reload.yaml
###

## update

- platform: template
  sensors:
    motion_update_required:
      friendly_name: 'Update required'
      icon_template: >-
        {% if is_state('binary_sensor.motion_addon_update','on') %}
          {{- 'mdi:update' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      value_template: >-
        {{ is_state('binary_sensor.motion_addon_update','on') }}

## reload

- platform: template
  sensors:
    motion_reload:
      friendly_name: 'Reload configuration'
      icon_template: >-
        {{- 'mdi:reload' -}}
      value_template: >-
        {% if is_state('input_boolean.motion_reload','on') %}
          {{- 'mdi:reload' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
    motion_reload_off:
      friendly_name: 'Automatic reload disabled'
      icon_template: >-
        {% if is_state('input_boolean.motion_reload_off','on') %}
          {{- 'mdi:cancel' -}}
        {% else %}
          {{- 'mdi:reload' -}}
        {% endif %}
      value_template: >-
        {{ is_state('input_boolean.motion_reload_off','on') }}
    motion_reload_required:
      friendly_name: 'Reload required'
      icon_template: >-
        {% if is_state('binary_sensor.motion_addon_reload','on') %}
          {{- 'mdi:refresh' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      value_template: >-
        {{ is_state('binary_sensor.motion_addon_reload','on') }}
    motion_reloading:
      friendly_name: 'Reloading'
      icon_template: >-
        {% set s = state_attr('automation.motion_reload','current') %}
        {% if s|int(0) > 0 %}
          {{- 'mdi:reload' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      attribute_templates:
        timestamp: >-
          {{ state_attr('automation.motion_reload','last_triggered')|as_timestamp(none)  }}
        markdown: >-
          {% if is_state('binary_sensor.motion_reloading','on') -%}
            <b>Reloading</b> at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -}}
          {%- else -%}
            {%- set s = state_attr('binary_sensor.motion_reloading','timestamp') -%}
            {%- if s|float(0) > 0 -%}
              {%- set s = s|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -%}
              <b>Reloaded</b> at {{ s }}
            {%- else -%}<i>Reload unknown</i>{%- endif -%}
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_reload','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}

## restart

- platform: template
  sensors:
    motion_restart:
      friendly_name: 'Restart system'
      icon_template: >-
        {% if is_state('input_boolean.motion_restart','on') %}
          {{- 'mdi:restart' -}}
        {% else %}
          {{- 'mdi:restart-off' -}}
        {% endif %}
      value_template: >-
        {{ is_state('input_boolean.motion_restart','on') }}
    motion_restart_required:
      friendly_name: 'Restart required'
      icon_template: >-
        {% if is_state('binary_sensor.motion_addon_restart','on') %}
          {{- 'mdi:restart' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      value_template: >-
        {{ is_state('binary_sensor.motion_addon_restart','on') }}
    motion_restart_off:
      friendly_name: 'Automatics restart disabled'
      icon_template: >-
        {% if is_state('input_boolean.motion_restart_off','on') %}
          {{- 'mdi:restart-off' -}}
        {% else %}
          {{- 'mdi:restart' -}}
        {% endif %}
      value_template: >-
        {{ is_state('input_boolean.motion_restart_off','on') }}
    motion_restarting:
      friendly_name: 'Restarting'
      icon_template: >-
        {% set s = state_attr('automation.motion_restart','current') %}
        {% if s|int(0) > 0 %}
          {{- 'mdi:restart' -}}
        {% elif s|int(-1) >= 0 %}
          {{- 'mdi:restart-off' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      attribute_templates:
        delay: 30
        timestamp: >-
          {{ state_attr('automation.motion_restart','last_triggered')|as_timestamp(none)  }}
        markdown: >-
          {% if is_state('binary_sensor.motion_restarting','on') -%}
            <b>Restarting</b> at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -}}
          {%- else -%}
            {%- set s = state_attr('binary_sensor.motion_restarting','timestamp') -%}
            {%- if s|float(0) > 0 -%}
              {%- set s = s|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -%}
              <b>Restarted</b> at {{ s }}
            {%- else -%}<i>Restart unknown</i>{%- endif -%}
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_restart','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}
    motion_rebooting:
      friendly_name: 'Rebooting'
      icon_template: >-
        {% if is_state('binary_sensor.motion_rebooting','on') %}
          {{- 'mdi:power-cycle-lock' -}}
        {% else %}
          {{- 'mdi:power' -}}
        {% endif %}
      attribute_templates:
        delay: 30
        markdown: >-
          {% if is_state('binary_sensor.motion_rebooting','on') %}
            <b>Rebooting</b> at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
          {% else %}
            Rebooted {{ states('sensor.last_boot')|as_datetime|relative_time }} ago
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_reboot','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_refresh:
      friendly_name: 'Restart add-on'
      icon_template: >-
        {{- 'mdi:refresh' -}}
      value_template: >-
        {{ is_state('input_boolean.motion_addon_refresh','on') }}
    motion_refresh_off:
      friendly_name: 'Automatic add-on restart disabled'
      icon_template: >-
        {% if is_state('input_boolean.motion_refresh_off','on') %}
          {{- 'mdi:cancel' -}}
        {% else %}
          {{- 'mdi:refresh' -}}
        {% endif %}
      value_template: >-
        {{ is_state('input_boolean.motion_refresh_off','on') }}
    motion_refreshing:
      friendly_name: 'Restarting add-on'
      icon_template: >-
        {% set s = state_attr('automation.motion_refresh','current') %}
        {% if s|int(0) > 0 %}
          {{- 'mdi:refresh' -}}
        {% else %}
          {{- 'mdi:cancel' -}}
        {% endif %}
      attribute_templates:
        timestamp: >-
          {{ state_attr('automation.motion_refresh','last_triggered')|as_timestamp(none)  }}
        markdown: >-
          {%- set icon = 'warning-icon-red' -%}
          {{- '<img src="/local/images/icons/' + icon + '.png?v1">' -}}
          {% if is_state('binary_sensor.motion_refreshing','on') -%}
            <b>Restarting</b> {{ state_attr('sensor.motion_name','title') }} at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -}}
          {%- else -%}
            {%- set s = state_attr('binary_sensor.motion_refreshing','timestamp') -%}
            {%- if s|float(0) > 0 -%}
              {%- set s = s|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') -%}
              <b>Restarted</b> {{ state_attr('sensor.motion_name','title') }} at {{ s }}
            {%- else -%}<i>Reload unknown</i>{%- endif -%}
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_refresh','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}

