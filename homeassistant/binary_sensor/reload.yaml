###
## homeassistant/binary_sensor/reload.yaml
###

- platform: template
  sensors:
    motion_reload:
      friendly_name: 'Reload indicator'
      icon_template: >-
        {% if is_state('input_boolean.motion_reload','on') %}
          {{- 'mdi:auto-download' -}}
        {% elif is_state('binary_sensor.motion_reload','on') %}
          {{- 'mdi:download-circle' -}}
        {% else %}
          {{- 'mdi:download-circle-outline' -}}
        {% endif %}
      value_template: >-
        {% set s = states('input_boolean.motion_reload') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s != null %}
          {{ s|lower == 'on' and (is_state('binary_sensor.motion_addon_reload','on') or is_state('binary_sensor.motion_addon_update','on')) }}
        {% else %}null{% endif %}
    motion_reloaded:
      friendly_name: 'Reloaded'
      icon_template: >-
        {% if is_state('binary_sensor.motion_reloaded','on') %}
          {{- 'mdi:download-box' -}}
        {% else %}
          {{- 'mdi:download-box-outline' -}}
        {% endif %}
      value_template: >-
        {% set s = states('binary_sensor.motion_reloaded') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s != null %}
          {{ s }}
        {% else %}null{% endif %}
    motion_reloading:
      friendly_name: 'Reloading'
      icon_template: >-
        {% if is_state('binary_sensor.motion_reloading','on') %}
          {{- 'mdi:download-lock' -}}
        {% else %}
          {{- 'mdi:download-outline' -}}
        {% endif %}
      attribute_templates:
        delay: 30
        markdown: >-
          {% if not is_state('binary_sensor.motion_reloading','on') %}
            The system is reloading at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
          {% else %}
            The system is <b>not</b> reloading at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_reload','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}
