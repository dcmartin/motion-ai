###
## homeassistant/binary_sensor/reload.yaml
###

- platform: template
  sensors:
    motion_reload_enabled:
      friendly_name: 'Reload enabled'
      icon_template: >-
        {% if is_state('input_boolean.motion_reload','on') %}
          {{- 'mdi:auto-download' -}}
        {% else %}
          {{- 'mdi:download-off' -}}
        {% endif %}
      value_template: >-
        {{ is_state('input_boolean.motion_reload','on') }}
    motion_reload:
      friendly_name: 'Reload indicator'
      icon_template: >-
        {% if is_state('binary_sensor.motion_addon_reload','on') %}
          {{- 'mdi:refresh' -}}
        {% elif is_state('binary_sensor.motion_addon_update','on') %}
          {{- 'mdi:update' -}}
        {% else %}
          {{- 'mdi:apps' -}}
        {% endif %}
      value_template: >-
        {{ is_state('binary_sensor.motion_addon_reload','on') or is_state('binary_sensor.motion_addon_update','on') }}
    motion_reloaded:
      friendly_name: 'Reloaded'
      icon_template: >-
        {% if is_state('binary_sensor.motion_reloaded','on') %}
          {{- 'mdi:download-box' -}}
        {% else %}
          {{- 'mdi:download-box-outline' -}}
        {% endif %}
      value_template: >-
        {% set s = states('binary_sensor.motion_reloaded') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s != null %}
          {{ s }}
        {% else %}null{% endif %}
    motion_reloading:
      friendly_name: 'Reloading'
      icon_template: >-
        {% if is_state('binary_sensor.motion_reloading','on') %}
          {{- 'mdi:download-lock' -}}
        {% else %}
          {{- 'mdi:download-outline' -}}
        {% endif %}
      attribute_templates:
        delay: 30
        markdown: >-
          {% if is_state('binary_sensor.motion_reloading','on') %}
            <b>Reloading</b> at {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
          {% else %}
            Reloaded {{ states('sensor.motion_uptime')|relative_time }} ago
          {% endif %}
      value_template: >-
        {% set s = state_attr('automation.motion_reload','current') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s|int(0) > 0 }}
        {% else %}null{% endif %}
