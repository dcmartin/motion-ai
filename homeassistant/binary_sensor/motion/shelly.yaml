###
# binary_sensor/motion/shelly.yaml
###

- platform: template
  sensors:
    motion_detector_shellies_publish:
      value_template: >-
        {% set s = states('input_boolean.motion_detector_shellies_publish') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{- s -}}
        {% else %}true{% endif %}
    motion_detector_shelly:
      friendly_name: Motion
      device_class: 'occupancy'
      availability_template: >-
        {% set s = state_attr('binary_sensor.motion_detector_shelly','status') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s.active|lower != 'false' }}
        {% else %}true{% endif %}
      icon_template: >-
        {% set s = state_attr('binary_sensor.motion_detector_shelly','status') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {% if s.motion|lower == 'true' %}
            {{- 'mdi:motion-sensor' -}}
          {% else %}
            {{- 'mdi:motion-sensor-off' -}}
          {% endif %}
        {% else %}
          {{- 'mdi:motion-sensor-off' -}}
        {% endif %}
      value_template: >-
        {% set s = state_attr('binary_sensor.motion_detector_shelly','status') %}
        {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
          {{ s.motion|lower == 'true' }}
        {% else %}false{% endif %}
