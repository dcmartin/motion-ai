###
## binary_sensor/motion/wakeup.yaml
###

- platform: template
  sensors:
    motion_schedule_wakeup_interval_detect:
      unique_id: motion_schedule_wakeup_interval_detect
      friendly_name: 'Wake interval person'
      icon_template: 'mdi:account-check'
      value_template: >-
        {% set t = as_timestamp(now().replace(hour=0).replace(minute=0).replace(second=0))|int(0) %}
        {% set b = states('input_number.motion_schedule_wakeup_begin')|int(0) + t %}
        {% set e = states('input_number.motion_schedule_wakeup_end')|int(0) + t %}
        {{ is_state('binary_sensor.motion_detected_person','on') or is_state('binary_sensor.motion_detected_person','off') and e > t > b }}
    motion_schedule_wakeup_detected:
      unique_id: motion_schedule_wakeup_detected
      friendly_name: 'Wake detected'
      icon_template: >-
        {%- if is_state('automation.motion_schedule_wakeup_detected_notify','on') -%}
          {%- if state_attr('automation.motion_schedule_wakeup_detected_notify','current')|int(0) > 0 -%}
            {{- 'mdi:check-bold' -}}
          {%- else -%}
            {{- 'mdi:alarm' -}}
          {%- endif -%}
        {%- else -%}
          {{- 'mdi:alarm-off' -}}
        {%- endif -%}
      value_template: >-
        {%- set e = states('sensor.motion_schedule_wakeup_detected') -%}
        {{- e|lower != 'none' and e|lower != 'unavailable' and e|lower != 'unknown' and e != null and e|int(0) > 0 -}}
    motion_schedule_wakeup_undetected:
      unique_id: motion_schedule_wakeup_undetected
      friendly_name: 'Wake not detected'
      icon_template: >-
        {%- if is_state('automation.motion_schedule_wakeup_undetected_notify','on') -%}
          {%- if state_attr('automation.motion_schedule_wakeup_undetected_notify','current')|int(0) > 0 -%}
             {{- 'mdi:alarm' -}}
          {%- else -%}{{- 'mdi:check-bold' -}}{%- endif -%}
        {%- else -%}{{- 'mdi:alarm-off' -}}{%- endif -%}
      value_template: >-
        {%- set e = state_attr('automation.motion_schedule_wakeup_undetected_notify','current') -%}
        {{- e|lower != 'none' and e|lower != 'unavailable' and e|lower != 'unknown' and e != null and e|int(0) > 0 -}}

- platform: template
  sensors:
    motion_schedule_wakeup_notify:
      value_template: >-
        {{ 
          is_state('binary_sensor.motion_schedule_wakeup_detected_notify','on')
          or
          is_state('binary_sensor.motion_schedule_wakeup_undetected_notify','on')
        }}
    motion_schedule_wakeup_detected_notify:
      unique_id: motion_schedule_wakeup_detected_notify
      friendly_name: 'Wake-up notify'
      icon_template: >-
        {%- if is_state('input_boolean.motion_schedule_wakeup_undetected_notify','on') -%}
          {{- 'mdi:alarm' -}}
        {%- else -%}
          {{- 'mdi:alarm-off' -}}
        {%- endif -%}
      value_template: >-
        {{ is_state('input_boolean.motion_schedule_wakeup_detected_notify','on') }}
    motion_schedule_wakeup_undetected_notify:
      unique_id: motion_schedule_wakeup_undetected_notify
      friendly_name: 'No wake-up notify'
      icon_template: >-
        {%- if is_state('input_boolean.motion_schedule_wakeup_undetected_notify','on') -%}
          {{- 'mdi:alarm' -}}
        {%- else -%}
          {{- 'mdi:alarm-off' -}}
        {%- endif -%}
      value_template: >-
        {{ is_state('input_boolean.motion_schedule_wakeup_undetected_notify','on') }}

- platform: template
  sensors:
    motion_schedule_wakeup_notifying:
      friendly_name: 'Wake notification'
      icon_template: 'mdi:alarm-check'
      value_template: >-
        {{ is_state('persistent_notification.wakeup_notify','notifying') }}
