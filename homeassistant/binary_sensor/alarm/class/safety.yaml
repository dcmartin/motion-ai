###
# homeassistant/binary_sensor/alarm/class/safety.yaml
###

- platform: template
  sensors:
    motion_alarm_safety:
      friendly_name: 'Alarm: safety'
      attribute_templates:
        bad: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','bad') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        good: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','good') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        low: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','low') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        high: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','high') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        activity: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','activity') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        missing: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','missing') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        unavailable: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','unavailble') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
        found: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','found') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'safety' in i[2] -%}
            {{ i[3] }}
          {%- else -%}none{%- endfor -%}
          {%- else -%}unknown{%- endif -%}
      value_template: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','all') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 2 and 'safety' in i[2] -%}
            {%- if loop.first -%}{{- 'on' -}}{%- endif -%}
          {%- else -%}{{- 'off' -}}{%- endfor -%}
        {%- else -%}{{- 'unknown' -}}{%- endif -%}
