###
# homeassistant/binary_sensor/alarm/class/battery.yaml
###

- platform: template
  sensors:
    motion_alarm_battery:
      friendly_name: 'Alarm: battery'
      attribute_templates:
        bad: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','bad') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>bad</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>bad</i> alarm information{%- endif -%}
        good: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','good') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>good</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>good</i> alarm information{%- endif -%}
        low: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','low') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>low</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>low</i> alarm information{%- endif -%}
        high: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','high') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>high</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>high</i> alarm information{%- endif -%}
        activity: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','activity') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>activity</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>activity</i> alarm information{%- endif -%}
        missing: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','missing') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>missing</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>missing</i> alarm information{%- endif -%}
        unavailable: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','unavailble') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>unavailable</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>unavailable</i> alarm information{%- endif -%}
        found: >-
          {%- set s = state_attr('binary_sensor.motion_alarm','found') -%}
          {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 3 and 'battery' in i[2] -%}
            {{ i[3] }}
          {%- else -%}No battery <i>found</i> alarm{%- endfor -%}
          {%- else -%}No battery <i>found</i> alarm information{%- endif -%}
      value_template: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','all') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {%- for i in s if i|count > 0 and 'battery' in i[0] -%}
            {%- if loop.first -%}{{- 'on' -}}{%- endif -%}
          {%- else -%}{{- 'off' -}}{%- endfor -%}
        {%- else -%}{{- 'unknown' -}}{%- endif -%}
