###
# homeassistant/sensor/omada.yaml
###

- platform: template
  sensors:
    omada:
      friendly_name: 'Omada controller'
      icon_template: 'mdi:lan'
      attribute_templates:
        url: >-
          {{ states('input_text.omada_url') }}
        username: >-
          {{ states('input_text.omada_username') }}
        password: >-
          {{ states('input_text.omada_password') }}
        api_version: >-
          {% set s = states('sensor.omada_rest_info') %}
          {% if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' %}
            {{ state_attr('sensor.omada_rest_info','result').apiVer }}
          {% else %}null{% endif %}
        configured: >-
          {% set s = states('sensor.omada_rest_info') %}
          {% if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' %}
            {{ state_attr('sensor.omada_rest_info','result').configured }}
          {% else %}null{% endif %}
        controller_version: >-
          {% set s = states('sensor.omada_rest_info') %}
          {% if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' %}
            {{ state_attr('sensor.omada_rest_info','result').controllerVer }}
          {% else %}null{% endif %}
        support_app: >-
          {% set s = states('sensor.omada_rest_info') %}
          {% if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' %}
            {{ state_attr('sensor.omada_rest_info','result').supportApp }}
          {% else %}null{% endif %}
        type: >-
          {% set s = states('sensor.omada_rest_info') %}
          {% if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' %}
            {{ state_attr('sensor.omada_rest_info','result').type }}
          {% else %}null{% endif %}
      value_template: >-
        {% set s = states('sensor.omada_rest_info') %}
        {{ s|lower != 'null' and s|lower != 'none' }}
