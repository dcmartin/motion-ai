###
## binary_sensor/uptimerobot.yaml
###

- platform: template
  sensors:
    uptimerobot_feed:
      device_class: connectivity
      friendly_name: UptimeRobot
      attribute_templates:
        markdown: >-
          <ul>
          <li>UptimeRobot connection is <b>{{- states('binary_sensor.uptimerobot_feed') -}}</b></li>
          <li>NabuCasa is <b>{{- states('binary_sensor.uptimerobot_link_up_nabucasa') -}}</b></li>
          </ul>
          <i>Last updated</i>: {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
      value_template: >-
        {{ not is_state('sensor.uptimerobot_feed','0') and not is_state('sensor.uptimerobot_feed','unknown') }}
    uptimerobot_link_up_nabucasa:
      device_class: connectivity
      friendly_name: NabuCasa
      attribute_templates:
        markdown: >-
          <ul>
          <li>NabuCasa connection is <b>{{- states('binary_sensor.uptimerobot_link_up_nabucasa') -}}</b></li>
          <li>UptimeRobot is <b>{{- states('binary_sensor.uptimerobot_feed') -}}</b></li>
          </ul>
          <i>Last updated</i>: {{ utcnow().timestamp()|timestamp_custom("%a %b %d %I:%M %p %Z",true,'unknown') }}
      value_template: >-
        {% set s = states('sensor.uptimerobot_link_up_nabucasa') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' and s|length > 0 %}
          {% set s = s.split(',')|list %}
          {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' and s is iterable %}
            {{ s|length > 0 }}
          {% else %}false{% endif %}
        {% else %}false{% endif %}
