###
## binary_sensor/systemmonitor.yaml
###

### TEMPERATURE

- platform: template
  sensors:
    sysmon_thermometer_low:
      friendly_name: 'CPU temperature low'
      icon_template: 'mdi:thermometer-low'
      value_template: >-
        {% set id = states('input_number.sysmon_thermometer_deviation') %}
        {% set ir = states('sensor.sysmon_thermometer') %}
        {% set irm = states('sensor.sysmon_thermometer_mean') %}
        {% set irsd = states('sensor.sysmon_thermometer_stdev') %}
        {% if id|lower != 'unavailable'
          and ir|lower != 'unavailable'
          and irm|lower != 'unavailable'
          and irsd|float(0.0) > 0 %}
          {{ (((irm|float(0.0)) - (ir|float(0.0))) / (irsd|float(0.0)) > (id|float(0.0))) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_high:
      friendly_name: 'CPU temperature high'
      icon_template: 'mdi:thermometer-high'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer')|float(0.0)) - (states('sensor.sysmon_thermometer_mean')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev')|float(0.0)))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0)) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_low_persistent:
      friendly_name: 'CPU temperature low persistent'
      icon_template: 'mdi:thermometer-minus'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer_mean')|float(0.0)) - (states('sensor.sysmon_thermometer')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev_mean')|float(0.0))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0))) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_high_persistent:
      friendly_name: 'CPU temperature high persistent'
      icon_template: 'mdi:thermometer-alert'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer')|float(0.0)) - (states('sensor.sysmon_thermometer_mean')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev_mean')|float(0.0)))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0)) }}
        {% else %}null{% endif %}

### LOAD

- platform: template
  sensors:
    sysmon_thermometer_low:
      friendly_name: 'CPU load low'
      icon_template: 'mdi:thermometer-low'
      value_template: >-
        {% set id = states('input_number.sysmon_thermometer_deviation') %}
        {% set ir = states('sensor.sysmon_thermometer') %}
        {% set irm = states('sensor.sysmon_thermometer_mean') %}
        {% set irsd = states('sensor.sysmon_thermometer_stdev') %}
        {% if id|lower != 'unavailable'
          and ir|lower != 'unavailable'
          and irm|lower != 'unavailable'
          and irsd|float(0.0) > 0 %}
          {{ (((irm|float(0.0)) - (ir|float(0.0))) / (irsd|float(0.0)) > (id|float(0.0))) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_high:
      friendly_name: 'CPU load high'
      icon_template: 'mdi:thermometer-high'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer')|float(0.0)) - (states('sensor.sysmon_thermometer_mean')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev')|float(0.0)))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0)) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_low_persistent:
      friendly_name: 'CPU load low persistent'
      icon_template: 'mdi:thermometer-minus'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer_mean')|float(0.0)) - (states('sensor.sysmon_thermometer')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev_mean')|float(0.0))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0))) }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    sysmon_thermometer_high_persistent:
      friendly_name: 'CPU load high persistent'
      icon_template: 'mdi:thermometer-alert'
      value_template: >-
        {% if states('input_number.sysmon_thermometer_deviation')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|lower != 'unavailable'
             and states('sensor.sysmon_thermometer_stdev_mean')|float(0.0) > 0 %}
        {{ (((states('sensor.sysmon_thermometer')|float(0.0)) - (states('sensor.sysmon_thermometer_mean')|float(0.0)))
             / (states('sensor.sysmon_thermometer_stdev_mean')|float(0.0)))
           > (states('input_number.sysmon_thermometer_deviation')|float(0.0)) }}
        {% else %}null{% endif %}

