###
# homeassistant/binary_sensor/device/notify/class/temperature.yaml
###

- platform: template
  sensors:
    motion_device_notify_temperature_high:
      friendly_name: Temperature high notification
      attribute_templates:
        id: >-
          {{ 'device-temperature-notification-high' }}
        title: >-
          {{- 'Check temperature at home' -}}
        subtitle: >-
          {{- 'High temperature' -}}
        image: >-
          {{- '/local/images/icons/notification-temperature-high.png' -}}
        message: >-
          {%- set max = state_attr('sensor.motion_device_temperature','max') ~ state_attr('sensor.motion_device_temperature','unit_of_measurement') -%}
          {%- set high = state_attr('binary_sensor.motion_device_temperature_exist','high') ~ state_attr('sensor.motion_device_temperature','unit_of_measurement') -%}
          {%- set humidity = state_attr('sensor.motion_device_humidity','mean') ~ state_attr('sensor.motion_device_humidity','unit_of_measurement') -%}
          {%- set temperature = state_attr('binary_sensor.weather_forecasted','temperature') ~ state_attr('sensor.motion_device_temperature','unit_of_measurement') -%}
          {%- set condition = state_attr('binary_sensor.weather_forecasted','condition') -%}
          {%- set humidity = state_attr('binary_sensor.weather_forecasted','humidity') ~ state_attr('sensor.motion_device_temperature','unit_of_measurement') -%}
          Check your cooling system at home.
          Your home temperature is {{ max }} which is above the target temperature of {{ high -}}.
          Indoor humidity level is {{ humidity -}}.
          The forecast is {{ condition }} today.
          Current temperature outdoors is {{ temperature -}}; humidity is {{ humidity -}}.
        critical: >-
          {{ false }}
        actions: >-
          {% set id = state_attr('sensor.motion_reload_notify','id') %}
          {% if id|lower != 'none' %}
            {% set interval = state_attr('sensor.motion_reload_notify','interval')|int(5) %}
            {% set actions = [
              {'action': id|string + '-approve','icon':'sfsymbols:hand.thumbsup','title':'OKAY','destructive':false},
              {'action': id|string + '-deny','icon':'sfsymbols:hand.thumbsdown.fill','title':'Deny system restart','destructive':true}
            ] %}
            {{ actions }}
          {% else %}none{% endif %}
        responses: >-
          {% set s = ['approve','deny'] -%}
          {{- s }}
        group: >-
          {{ 'system-health' }}
          {% set s = state_attr('binary_sensor.motion_addon_update','id') %}
          {%- if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' -%}
            {% set s = state_attr('binary_sensor.motion_addon_' + s + '_start','timestamp') %}
            {%- if s|lower != 'none' and s|int(0) > 0 -%}
              {% set u = states('sensor.motion_uptime') %}
              {% if u|as_timestamp(0) > 0 %}
                {{ s|int(0) > u|as_timestamp|int }}
              {% else %}unknown{% endif %}
            {%- else -%}unknown{%- endif %}
          {%- else -%}unknown{%- endif %}
      icon_template: >-
        {%- if is_state_attr('binary_sensor.motion_addon_update','addon','age_home') -%}
          {{- 'mdi:home-heart' -}}
        {%- elif is_state_attr('binary_sensor.motion_addon_update','addon','motion_classic') -%}
           {{- 'mdi:eye-plus' -}}
        {%- else -%}
           {{- 'mdi:cancel' -}}
        {%- endif %}
      value_template: >-
        {%- set s = state_attr('binary_sensor.motion_addon_update','addon') -%}
        {{- s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' -}}
