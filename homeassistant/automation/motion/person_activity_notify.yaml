###
# homeassistant/automation/motion/person_activity_notify.yaml
###

## estimated

- id: motion_person_location_estimated_unknown_notify
  alias: motion_person_location_estimated_unknown_notify
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location_estimated
  condition:
    - condition: template
      value_template: >
        {{ is_state('sensor.motion_person_location_estimated','unknown') }}
  variables:
    title: >-
      WARN: Estimated location unknown
    message: >-
      The estimated location from person detection is unknown; at {{ now().timestamp()|int|timestamp_custom("%a %b %d %I:%M %p %Z") }}
  action:
    - alias: 'notify'
      service: persistent_notification.create
      data_template:
        title: >-
          {{ title }}
        notification_id: motion_person_location_estimated_unknown
        message: >-
          {{ message }}

- id: motion_person_location_estimated_unknown_dismiss
  alias: motion_person_location_estimated_unknown_dismiss
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location_estimated
  condition:
    - condition: template
      value_template: >
        {{ not is_state('sensor.motion_person_location_estimated','unknown') }}
  action:
    - alias: 'dismiss'
      service: persistent_notification.dismiss
      data_template:
        notification_id: motion_person_location_estimated_unknown

## occupancy

- id: motion_person_location_occupancy_unknown_notify
  alias: motion_person_location_occupancy_unknown_notify
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location_occupancy
  condition:
    - condition: template
      value_template: >
        {{ is_state('sensor.motion_person_location_occupancy','unknown') }}
  variables:
    title: >-
      WARN: Occupancy unknown
    message: >-
      Occupancy from motion detection is unknown; at {{ now().timestamp()|int|timestamp_custom("%a %b %d %I:%M %p %Z") }}
  action:
    - alias: 'notify'
      service: persistent_notification.create
      data_template:
        title: >-
          {{ title }}
        notification_id: motion_person_location_occupancy_unknown
        message: >-
          {{ message }}

- id: motion_person_location_occupancy_unknown_dismiss
  alias: motion_person_location_occupancy_unknown_dismiss
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location_occupancy
  condition:
    - condition: template
      value_template: >
        {{ not is_state('sensor.motion_person_location_occupancy','unknown') }}
  action:
    - alias: 'dismiss'
      service: persistent_notification.dismiss
      data_template:
        notification_id: motion_person_location_occupancy_unknown

## smartphone

- id: motion_person_location_unknown_notify
  alias: motion_person_location_unknown_notify
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location
  condition:
    - condition: template
      value_template: >
        {{ is_state('sensor.motion_person_location','unknown') }}
  variables:
    title: >-
      WARN: Smartphone not found
    message: >-
      The location from smartphone is unknown; at {{ now().timestamp()|int|timestamp_custom("%a %b %d %I:%M %p %Z") }}
  action:
    - alias: 'notify'
      service: persistent_notification.create
      data_template:
        title: >-
          {{ title }}
        notification_id: motion_person_location_unknown
        message: >-
          {{ message }}

- id: motion_person_location_unknown_dismiss
  alias: motion_person_location_unknown_dismiss
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_person_location_occupancy
  condition:
    - condition: template
      value_template: >
        {{ not is_state('sensor.motion_person_location','unknown') }}
  action:
    - alias: 'dismiss'
      service: persistent_notification.dismiss
      data_template:
        notification_id: motion_person_location_unknown
