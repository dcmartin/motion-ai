###
# homeassistant/automation/motion/camera_restart.yaml
###

- id: motion_addon_camera_restart
  alias: motion_addon_camera_restart
  initial_state: off
  trigger:
    - platform: mqtt
      topic: 'motion/+/+/status/+'
  condition:
     condition: template
     value_template: >
       {{ is_state('input_boolean.motion_addon_camera_restart','on') }}
  action:
    - service: switch.turn_off
      data_template:
        entity_id: >-
          {% set offline = states('sensor.motion_addon_status_camera_offline')|replace('\'','"')|from_json %}
          {% for state in states.switch %}
            {% for ol in offline %}
            {% if ol in state.name|lower %}{{ state.entity_id }}{% endif %}
            {% endfor %}
          {% endfor %}
    - service: switch.turn_on
      data_template:
        entity_id: >-
          {% set offline = states('sensor.motion_addon_status_camera_offline')|replace('\'','"')|from_json %}
          {% for state in states.switch %}
            {% for ol in offline %}
            {% if ol in state.name|lower %}{{ state.entity_id }}{% endif %}
            {% endfor %}
          {% endfor %}
