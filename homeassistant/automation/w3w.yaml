###
# homeassistant/automation/w3w.yaml
###

- id: motion_w3w_location_update
  alias: motion_w3w_location_update
  initial_state: on
  trigger:
    - platform: state
      entity_id: sensor.motion_w3w_location
      attribute: 'apikey'
    - platform: state
      entity_id: sensor.motion_w3w_location
      attribute: 'words'
  condition:
    - condition: template
      value_template: >
        {% set s = state_attr('sensor.motion_w3w_location','apikey') %}
        {{ s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' and s|string != 'APIKEY4U' }}
    - condition: template
      value_template: >
        {% set s = state_attr('sensor.motion_w3w_location','words') %}
        {{ s|lower != 'none' and s|lower != 'unknown' and s|lower != 'null' and s|lower != 'unavailable' and s|string != '///what.three.words' }}
  action:
    - alias: 'update w3w location'
      service: homeassistant.update_entity
      entity_id: 'sensor.motion_w3w_location_rest'
