###
## AUTO-GENERATED from homeassistant/motion/binary_sensor.detected_animal.yaml.tmpl
##
## - MOTION_CAMERA: ${MOTION_CAMERA}
###

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_animal:
      friendly_name: '${MOTION_CAMERA} ðŸ„ detected'
      icon_template: 'mdi:check'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_DETECTED}_detected_animal_expired','off') %}
          {% set results = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','results') %}
          {% if results|lower != 'none' and results|lower != 'unavailable' and results|lower != 'unknown' and results|lower != 'null' and results|length > 0 %}
            {% set option = states('input_select.motion_detect_animal') %}
            {% if option|lower == 'all' or option|lower == 'animal' %}
              {% set options = state_attr('input_select.motion_detect_animal','options') %}
              {% if options|lower != 'none' and options|lower != 'unknown' and options|length > 0 %}
                {% set l = results|selectattr('entity','in',options)|map(attribute='confidence')|list %}
              {% endif %}
            {% else %}
              {% set l = results|selectattr('entity','==',option)|map(attribute='confidence')|list %}
            {% endif %}
            {% if l is defined and l is iterable and l|length > 0 %}
              {% set p = l|list|max|int %}
              {{ p >= states('sensor.motion_detected_animal_threshold')|int }}
            {% else %}false{% endif %}
          {% else %}false{% endif %}
        {% else %}false{% endif %}
    motion_${MOTION_CAMERA}_detected_animal_old:
      value_template: >-
        {{ as_timestamp(states.binary_sensor.motion_${MOTION_CAMERA}_detected_animal.last_updated) < as_timestamp(states.sensor.motion_event_annotated.last_updated) }}
    motion_${MOTION_CAMERA}_detected_animal_expired:
      friendly_name: '${MOTION_CAMERA} ðŸ„ expired'
      icon_template: 'mdi:cow'
      device_class: occupancy
      value_template: >-
        {{ states('sensor.motion_${MOTION_CAMERA}_detected_animal_ago')|int > states('input_number.motion_detected_animal_ago')|int }}
    motion_${MOTION_CAMERA}_detected_animal_notify:
      friendly_name: '${MOTION_CAMERA} animal notify'
      icon_template: 'mdi:${MOTION_CAMERA_ICON}'
      value_template: >-
        {{ is_state('input_boolean.motion_${MOTION_CAMERA}_detected_animal_notify','on') and is_state('input_boolean.motion_detected_animal_notify','off') }}
    motion_${MOTION_CAMERA}_detected_animal_speak:
      friendly_name: '${MOTION_CAMERA} animal speak'
      icon_template: 'mdi:${MOTION_CAMERA_ICON}'
      value_template: >-
        {{ is_state('input_boolean.motion_${MOTION_CAMERA}_detected_animal_speak','on') and is_state('input_boolean.motion_detected_animal_speak','off') }}
    motion_${MOTION_CAMERA}_detected_animal_tune:
      friendly_name: '${MOTION_CAMERA} animal tune'
      icon_template: 'mdi:${MOTION_CAMERA_ICON}'
      value_template: >-
        {{ is_state('input_boolean.motion_${MOTION_CAMERA}_detected_animal_tune','on') or is_state('input_boolean.motion_detected_animal_tune','on') }}
