###
## AUTO-GENERATED from homeassistant/motion/automation.webcam.yaml.tmpl
##
## - MOTION_DEVICE: ${MOTION_DEVICE}
## - MOTION_CAMERA: ${MOTION_CAMERA}
###

## media

- id: motion_detected_entity_media_animated_${MOTION_CAMERA}
  alias: motion_detected_entity_media_animated_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: sensor.motion_detected_entity_date_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_media_save','on') }}
      - condition: template
        value_template: >-
          {{ states('sensor.motion_detected_entity_date_${MOTION_CAMERA}')|int > 0 }}
      - condition: template
        value_template: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
          {% endif %}
        filename: >-
          {% set s = states('sensor.motion_detected_entity_date_${MOTION_CAMERA}')|int %}
          {% set w = s|timestamp_custom("%H:%M:%S") %}
          {% set year = s|timestamp_custom("%Y") %}
          {% set month = s|timestamp_custom("%b") %}
          {% set day = s|timestamp_custom("%d") %}
          {{ '/media/Motion-Ã👁/' + year + '-' + month + '-' + day + '/entity/' + w + ' at ${MOTION_CAMERA}.gif' }}

- id: motion_detected_person_media_animated_${MOTION_CAMERA}
  alias: motion_detected_person_media_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_detected_person_date_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_media_save','on') }}
      - condition: template
        value_template: >-
          {{ states('sensor.motion_detected_person_date_${MOTION_CAMERA}')|int > 0 }}
      - condition: template
        value_template: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
          {% endif %}
        filename: >-
          {% set s = states('sensor.motion_detected_person_date_${MOTION_CAMERA}')|int %}
          {% set w = s|timestamp_custom("%H:%M:%S") %}
          {% set year = s|timestamp_custom("%Y") %}
          {% set month = s|timestamp_custom("%b") %}
          {% set day = s|timestamp_custom("%d") %}
          {{ '/media/Motion-Ã👁/' + year + '-' + month + '-' + day + '/person/' + w + ' at ${MOTION_CAMERA}.gif' }}

- id: motion_detected_vehicle_media_animated_${MOTION_CAMERA}
  alias: motion_detected_vehicle_media_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_detected_vehicle_date_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_media_save','on') }}
      - condition: template
        value_template: >-
          {{ states('sensor.motion_detected_vehicle_date_${MOTION_CAMERA}')|int > 0 }}
      - condition: template
        value_template: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
          {% endif %}
        filename: >-
          {% set s = states('sensor.motion_detected_vehicle_date_${MOTION_CAMERA}')|int %}
          {% set w = s|timestamp_custom("%H:%M:%S") %}
          {% set year = s|timestamp_custom("%Y") %}
          {% set month = s|timestamp_custom("%b") %}
          {% set day = s|timestamp_custom("%d") %}
          {{ '/media/Motion-Ã👁/' + year + '-' + month + '-' + day + '/vehicle/' + w + ' at ${MOTION_CAMERA}.gif' }}

- id: motion_detected_animal_media_animated_${MOTION_CAMERA}
  alias: motion_detected_animal_media_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_detected_animal_date_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_media_save','on') }}
      - condition: template
        value_template: >-
          {{ states('sensor.motion_detected_animal_date_${MOTION_CAMERA}')|int > 0 }}
      - condition: template
        value_template: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if is_state('input_boolean.motion_media_mask','off') %}
            {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
          {% endif %}
        filename: >-
          {% set s = states('sensor.motion_detected_animal_date_${MOTION_CAMERA}')|int %}
          {% set w = s|timestamp_custom("%H:%M:%S") %}
          {% set year = s|timestamp_custom("%Y") %}
          {% set month = s|timestamp_custom("%b") %}
          {% set day = s|timestamp_custom("%d") %}
          {{ '/media/Motion-Ã👁/' + year + '-' + month + '-' + day + '/animal/' + w + ' at ${MOTION_CAMERA}.gif' }}

###
# counters
###

# lost
- id: motion_status_camera_lost_counter_${MOTION_CAMERA}
  alias: motion_status_camera_lost_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_status_camera_lost_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_status_camera_lost_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_status_camera_lost_counter_${MOTION_CAMERA}

# found
- id: motion_status_camera_found_counter_${MOTION_CAMERA}
  alias: motion_status_camera_found_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_status_camera_found_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_status_camera_found_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_status_camera_found_counter_${MOTION_CAMERA}

# end
- id: motion_end_counter_${MOTION_CAMERA}
  alias: motion_end_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_end_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_end_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_end_counter_${MOTION_CAMERA}

# annotated
- id: motion_annotated_counter_${MOTION_CAMERA}
  alias: motion_annotated_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_annotated_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_annotated_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_annotated_counter_${MOTION_CAMERA}

# detected
- id: motion_detected_counter_${MOTION_CAMERA}
  alias: motion_detected_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_detected_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_detected_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_detected_counter_${MOTION_CAMERA}

# detected_entity
- id: motion_detected_entity_counter_${MOTION_CAMERA}
  alias: motion_detected_entity_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_detected_entity_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_detected_entity_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}

# detected_person
- id: motion_detected_person_counter_${MOTION_CAMERA}
  alias: motion_detected_person_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_detected_person_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_detected_person_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_detected_person_counter_${MOTION_CAMERA}

# detected_vehicle
- id: motion_detected_vehicle_counter_${MOTION_CAMERA}
  alias: motion_detected_vehicle_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_detected_vehicle_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_detected_vehicle_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_detected_vehicle_counter_${MOTION_CAMERA}

# detected_animal
- id: motion_detected_animal_counter_${MOTION_CAMERA}
  alias: motion_detected_animal_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_detected_animal_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_detected_animal_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_detected_animal_counter_${MOTION_CAMERA}

# face
- id: motion_face_counter_${MOTION_CAMERA}
  alias: motion_face_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_face_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_face_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_face_counter_${MOTION_CAMERA}

# face_detected
- id: motion_face_detected_counter_${MOTION_CAMERA}
  alias: motion_face_detected_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_face_detected_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_face_detected_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_face_detected_counter_${MOTION_CAMERA}

# alpr
- id: motion_alpr_counter_${MOTION_CAMERA}
  alias: motion_alpr_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_alpr_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_alpr_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_alpr_counter_${MOTION_CAMERA}

# alpr_detected
- id: motion_alpr_detected_counter_${MOTION_CAMERA}
  alias: motion_alpr_detected_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_alpr_detected_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_alpr_detected_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_alpr_detected_counter_${MOTION_CAMERA}

# person_face
- id: motion_person_face_counter_${MOTION_CAMERA}
  alias: motion_person_face_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_person_face_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_person_face_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_person_face_counter_${MOTION_CAMERA}

# vehicle_alpr
- id: motion_vehicle_alpr_counter_${MOTION_CAMERA}
  alias: motion_vehicle_alpr_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_vehicle_alpr_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_vehicle_alpr_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_vehicle_alpr_counter_${MOTION_CAMERA}

###
## capture source events
###

# end
- id: motion_end_snapshot_${MOTION_CAMERA}
  alias: motion_end_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_end_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_end_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_end_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_end_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_end-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_end' }}
        file_path: >-
          {{ '/config/www/images/motion_end-${MOTION_CAMERA}.jpg' }}

# composite
- id: motion_end_composite_snapshot_${MOTION_CAMERA}
  alias: motion_end_composite_snapshot_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_end_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_end_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_end_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_end_composite-${MOTION_CAMERA}.jpg' }}

# animated
- id: motion_end_animated_snapshot_${MOTION_CAMERA}
  alias: motion_end_animated_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_end_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_end_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_end_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_end_animated-${MOTION_CAMERA}.gif' }}

# animated_mask
- id: motion_end_animated_mask_snapshot_${MOTION_CAMERA}
  alias: motion_end_animated_mask_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_end_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_end_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_end_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_end_animated_mask-${MOTION_CAMERA}.gif' }}

# annotated
- id: motion_annotated_camera_snapshot_${MOTION_CAMERA}
  alias: motion_annotated_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_annotated_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    # snapshot
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if states('sensor.motion_annotated_count_${MOTION_CAMERA}')|int > 0 %}
            {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_nosignal' }}
          {% endif %}
        filename: >-
          {{ '/config/www/images/motion_annotated-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data:
        entity_id: camera.motion_annotated
        file_path: '/config/www/images/motion_annotated-${MOTION_CAMERA}.jpg'

# face
- id: motion_face_snapshot_${MOTION_CAMERA}
  alias: motion_face_snapshot_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_face_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_face_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_face_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if states('sensor.motion_face_count_${MOTION_CAMERA}')|int > 0 %}
            {{ 'camera.motion_event_face_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_nosignal' }}
          {% endif %}
        filename: >-
          {{ '/config/www/images/motion_face-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data:
        entity_id: camera.motion_face
        file_path: '/config/www/images/motion_face-${MOTION_CAMERA}.jpg'

# alpr
- id: motion_alpr_snapshot_${MOTION_CAMERA}
  alias: motion_alpr_snapshot_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_alpr_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_alpr_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_alpr_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {% if states('sensor.motion_alpr_count_${MOTION_CAMERA}')|int > 0 %}
            {{ 'camera.motion_event_alpr_${MOTION_CAMERA}' }}
          {% else %}
            {{ 'camera.motion_nosignal' }}
          {% endif %}
        filename: >-
          {{ '/config/www/images/motion_alpr-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data:
        entity_id: camera.motion_alpr
        file_path: '/config/www/images/motion_alpr-${MOTION_CAMERA}.jpg'

###
# camera update
###

## annotated
- id: motion_annotated_camera_composite_${MOTION_CAMERA}
  alias: motion_annotated_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_annotated_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_annotated_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_annotated_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_annotated_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_annotated_camera_animated_${MOTION_CAMERA}
  alias: motion_annotated_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_annotated_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_annotated_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_annotated_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_annotated_animated-${MOTION_CAMERA}.gif' }}

- id: motion_annotated_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_annotated_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_annotated_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_annotated_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_annotated_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_annotated_animated_mask-${MOTION_CAMERA}.gif' }}

## detected
- id: motion_detected_camera_snapshot_${MOTION_CAMERA}
  alias: motion_detected_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected' }}
        file_path: >-
          {{ '/config/www/images/motion_detected-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_camera_composite_${MOTION_CAMERA}
  alias: motion_detected_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_camera_animated_${MOTION_CAMERA}
  alias: motion_detected_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animated-${MOTION_CAMERA}.gif' }}

- id: motion_detected_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_detected_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animated_mask-${MOTION_CAMERA}.gif' }}

## detected_entity
- id: motion_detected_entity_camera_snapshot_${MOTION_CAMERA}
  alias: motion_detected_entity_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_entity-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_entity' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_entity-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_entity_camera_composite_${MOTION_CAMERA}
  alias: motion_detected_entity_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_entity_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_entity_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_entity_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_entity_camera_animated_${MOTION_CAMERA}
  alias: motion_detected_entity_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_entity_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_entity_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_entity_animated-${MOTION_CAMERA}.gif' }}

- id: motion_detected_entity_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_detected_entity_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_entity_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_entity_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_entity_animated_mask-${MOTION_CAMERA}.gif' }}

## detected_person
- id: motion_detected_person_camera_snapshot_${MOTION_CAMERA}
  alias: motion_detected_person_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_person_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_person-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_person-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_person_camera_composite_${MOTION_CAMERA}
  alias: motion_detected_person_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_detected_person_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_person_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_person_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_person_camera_animated_${MOTION_CAMERA}
  alias: motion_detected_person_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_person_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_person_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_person_animated-${MOTION_CAMERA}.gif' }}

- id: motion_detected_person_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_detected_person_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_person_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_person_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_person_animated_mask-${MOTION_CAMERA}.gif' }}

## detected_vehicle
- id: motion_detected_vehicle_camera_snapshot_${MOTION_CAMERA}
  alias: motion_detected_vehicle_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_vehicle_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_vehicle-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_vehicle-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_vehicle_camera_composite_${MOTION_CAMERA}
  alias: motion_detected_vehicle_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_detected_vehicle_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_vehicle_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_vehicle_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_vehicle_camera_animated_${MOTION_CAMERA}
  alias: motion_detected_vehicle_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_vehicle_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_vehicle_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_vehicle_animated-${MOTION_CAMERA}.gif' }}

- id: motion_detected_vehicle_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_detected_vehicle_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_vehicle_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_vehicle_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_vehicle_animated_mask-${MOTION_CAMERA}.gif' }}

## detected_animal
- id: motion_detected_animal_camera_snapshot_${MOTION_CAMERA}
  alias: motion_detected_animal_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_animal_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_annotated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_annotated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animal-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animal' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animal-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_animal_camera_composite_${MOTION_CAMERA}
  alias: motion_detected_animal_camera_composite_${MOTION_CAMERA}
  initial_state: off
  trigger:
    platform: state
    entity_id: counter.motion_detected_animal_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_composite_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_composite_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animal_composite-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animal_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animal_composite-${MOTION_CAMERA}.jpg' }}

- id: motion_detected_animal_camera_animated_${MOTION_CAMERA}
  alias: motion_detected_animal_camera_animated_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_animal_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animal_animated-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animal_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animal_animated-${MOTION_CAMERA}.gif' }}

- id: motion_detected_animal_camera_animated_mask_${MOTION_CAMERA}
  alias: motion_detected_animal_camera_animated_mask_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_detected_animal_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_animated_mask_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_animated_mask_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_detected_animal_animated_mask-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_animal_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_detected_animal_animated_mask-${MOTION_CAMERA}.gif' }}

## face_detected
- id: motion_face_detected_camera_snapshot_${MOTION_CAMERA}
  alias: motion_face_detected_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_face_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_face_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_face_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    # snapshot face cameras
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_face_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_face_detected_${MOTION_CAMERA}.jpg' }}
    # update global cameras
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_face_detected' }}
        file_path: >-
          {{ '/config/www/images/motion_face_detected-${MOTION_CAMERA}.jpg' }}

## alpr_detected
- id: motion_alpr_detected_camera_snapshot_${MOTION_CAMERA}
  alias: motion_alpr_detected_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_alpr_detected_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_event_alpr_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_event_alpr_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    # snapshot alpr cameras
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_event_alpr_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_alpr_detected_${MOTION_CAMERA}.jpg' }}
    # update global cameras
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_alpr_detected' }}
        file_path: >-
          {{ '/config/www/images/motion_alpr_detected-${MOTION_CAMERA}.jpg' }}

## person_face
- id: motion_person_face_camera_snapshot_${MOTION_CAMERA}
  alias: motion_person_face_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_person_face_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_detected_person_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_detected_person_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    # snapshot person cameras
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_person_face-${MOTION_CAMERA}.jpg' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_person_face_composite-${MOTION_CAMERA}.jpg' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_person_face-${MOTION_CAMERA}.gif' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_person_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_person_face_mask-${MOTION_CAMERA}.gif' }}
    # update global cameras
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_person_face' }}
        file_path: >-
          {{ '/config/www/images/motion_person_face-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_person_face_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_person_face-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_person_face_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_person_face-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_person_face_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_person_face_mask-${MOTION_CAMERA}.gif' }}

## vehicle_alpr
- id: motion_vehicle_alpr_camera_snapshot_${MOTION_CAMERA}
  alias: motion_vehicle_alpr_camera_snapshot_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_vehicle_alpr_counter_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >-
          {{ is_state('input_boolean.motion_snapshot_save','on') }}
      - condition: template
        value_template: >-
          {% set s = states('camera.motion_detected_vehicle_${MOTION_CAMERA}') %}
          {% if s is not none and s|lower != 'null' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' %}
            {% set ep = state_attr('camera.motion_detected_vehicle_${MOTION_CAMERA}','entity_picture') %}
            {{ ep is not none and ep|lower != 'unavailable' and ep|lower != 'none' and ep|lower != 'unknown' }}
          {% else %}false{% endif %}
  action:
    # snapshot vehicle cameras
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_vehicle_alpr-${MOTION_CAMERA}.jpg' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_composite_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_vehicle_alpr_composite-${MOTION_CAMERA}.jpg' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_animated_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_vehicle_alpr-${MOTION_CAMERA}.gif' }}
    - service: camera.snapshot
      data_template:
        entity_id: >-
          {{ 'camera.motion_detected_vehicle_animated_mask_${MOTION_CAMERA}' }}
        filename: >-
          {{ '/config/www/images/motion_vehicle_alpr_mask-${MOTION_CAMERA}.gif' }}
    # update global cameras
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_vehicle_alpr' }}
        file_path: >-
          {{ '/config/www/images/motion_vehicle_alpr-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_vehicle_alpr_composite' }}
        file_path: >-
          {{ '/config/www/images/motion_vehicle_alpr-${MOTION_CAMERA}.jpg' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_vehicle_alpr_animated' }}
        file_path: >-
          {{ '/config/www/images/motion_vehicle_alpr-${MOTION_CAMERA}.gif' }}
    - service: local_file.update_file_path
      data_template:
        entity_id: >-
          {{ 'camera.motion_vehicle_alpr_animated_mask' }}
        file_path: >-
          {{ '/config/www/images/motion_vehicle_alpr_mask-${MOTION_CAMERA}.gif' }}

###
# found
###

- id: motion_tracker_found_${MOTION_CAMERA}
  alias: motion_tracker_found_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: counter.motion_status_camera_found_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >
          {{ is_state('input_boolean.motion_tracker_found','on') }}
      - condition: template
        value_template: >
          {{ trigger.to_state.state != trigger.from_state.state }}
  action:
    - service: mqtt.publish
      data_template:
        topic: '${MOTION_GROUP}/tracker/${MOTION_DEVICE}/${MOTION_CAMERA}'
        retain: true
        payload_template: >-
          { "topic":"${MOTION_GROUP}/tracker/${MOTION_DEVICE}/${MOTION_CAMERA}", "payload":"home", "date":{{ (utcnow().timestamp()|int) }} }

###
# lost
###

- id: motion_tracker_lost_${MOTION_CAMERA}
  alias: motion_tracker_lost_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_status_camera_lost_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >
          {{ is_state('input_boolean.motion_tracker_lost','on') }}
      - condition: template
        value_template: >
          {{ trigger.to_state.state != trigger.from_state.state }}
  action:
    - service: mqtt.publish
      data_template:
        topic: '${MOTION_GROUP}/tracker/${MOTION_DEVICE}/${MOTION_CAMERA}'
        retain: true
        payload_template: >-
          { "topic":"${MOTION_GROUP}/tracker/${MOTION_DEVICE}/${MOTION_CAMERA}", "payload":"not_home", "date":{{ (utcnow().timestamp()|int) }} }

###
# notify lost and found
###

## found
- id: motion_status_camera_notify_found_${MOTION_CAMERA}
  alias: motion_status_camera_notify_found_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_status_camera_found_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >
          {{ is_state('input_boolean.motion_status_camera_notify','on') }}
      - condition: template
        value_template: >
          {{ trigger.to_state.state != trigger.from_state.state and trigger.to_state|lower != 'none' and trigger.to_state.state|lower != 'unknown' }}
  action:
    - service: persistent_notification.create
      data_template:
        title: >
          Camera ${MOTION_CAMERA} found
        notification_id: >
          ${MOTION_CAMERA}
        message: >-
          Camera ${MOTION_CAMERA} was {{ trigger.from_state.state }};
          found at {{ now().timestamp()|int|timestamp_custom("%a %b %d @ %I:%M %p %Z") | default(null) }}

## lost
- id: motion_status_camera_notify_lost_${MOTION_CAMERA}
  alias: motion_status_camera_notify_lost_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.motion_status_camera_lost_${MOTION_CAMERA}
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: >
          {{ is_state('input_boolean.motion_status_camera_notify','on') }}
      - condition: template
        value_template: >
          {{ trigger.to_state.state != trigger.from_state.state and trigger.to_state|lower != 'none' and trigger.to_state.state|lower != 'unknown' }}
  action:
    - service: persistent_notification.create
      data_template:
        title: >
          Camera ${MOTION_CAMERA} lost
        notification_id: >
          ${MOTION_CAMERA}
        message: >-
          Camera ${MOTION_CAMERA} was {{ trigger.from_state.state }};
          lost at {{ now().timestamp()|int|timestamp_custom("%a %b %d @ %I:%M %p %Z") | default(null) }}

###
# notify detected
###

- id: motion_detected_notify_${MOTION_CAMERA}
  alias: motion_detected_notify_${MOTION_CAMERA}
  initial_state: off
  trigger:
    - platform: state
      entity_id: counter.motion_detected_counter_${MOTION_CAMERA}
  condition:
    condition: template
    value_template: >
      {{ is_state('input_boolean.motion_detected_notify','on') }}
  action:
    - service: persistent_notification.create
      data_template:
        title: >-
          Detected {{ states.sensor.motion_annotated_count_${MOTION_CAMERA}.state }} {{ states.sensor.motion_detect_entity.state }}(s)
          from {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera }}
        notification_id: >
          detected-{{- states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera -}}
        message: >-
          Detected {{ states.sensor.motion_annotated_count_${MOTION_CAMERA}.state }} {{ states.sensor.motion_detect_entity.state }}(s)
          from {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera }}
          for {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.elapsed }} seconds
          ({{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.images|length }} frames)
          at {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.start|int|timestamp_custom("%a %b %d @ %I:%M %p UTC") | default(null) }}

##
# notify detected_entity
##

- id: motion_detected_entity_notify_${MOTION_CAMERA}
  alias: motion_detected_entity_notify_${MOTION_CAMERA}
  initial_state: off
  trigger:
    - platform: state
      entity_id: counter.motion_detected_entity_counter_${MOTION_CAMERA}
  condition:
    condition: template
    value_template: >
      {{ is_state('input_boolean.motion_detected_entity_notify','on') }}
  action:
    - service: persistent_notification.create
      data_template:
        title: >-
          Detected {{ states.sensor.motion_annotated_count_entity_${MOTION_CAMERA}.state }} {{ states.sensor.motion_detect_entity.state }}(s)
          from {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera }}
        notification_id: >
          detected_entity-{{- states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera -}}
        message: >-
          Detected {{ states.sensor.motion_annotated_count_entity_${MOTION_CAMERA}.state }} {{ states.sensor.motion_detect_entity.state }}(s)
          from {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.camera }}
          for {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.elapsed }} seconds
          ({{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.images|length }} frames)
          at {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.start|int|timestamp_custom("%a %b %d @ %I:%M %p UTC") | default(null) }}

##
# complete
##

- id: motion_complete_counter_${MOTION_CAMERA}
  alias: motion_complete_counter_${MOTION_CAMERA}
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.motion_complete_${MOTION_CAMERA}
  condition:
    - condition: template
      value_template: >-
        {{ is_state('binary_sensor.motion_complete_${MOTION_CAMERA}','on') }}
  action:
    - service: counter.increment
      entity_id: counter.motion_complete_counter_${MOTION_CAMERA}
