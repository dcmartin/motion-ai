###
## AUTO-GENERATED from homeassistant/motion/sensor.webcam.yaml.tmpl
##
## - MOTION_GROUP: ${MOTION_GROUP}
## - MOTION_CLIENT: ${MOTION_CLIENT}
## - MOTION_CAMERA: ${MOTION_CAMERA}
## - MOTION_CAMERA_ICON: ${MOTION_CAMERA_ICON}
## - MOTION_CAMERA_LATITUDE: ${MOTION_CAMERA_LATITUDE}
## - MOTION_CAMERA_LONGITUDE: ${MOTION_CAMERA_LONGITUDE}
###

###
## status
###

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera:
      unique_id: motion_${MOTION_CAMERA}_status_camera
      friendly_name: '${MOTION_CAMERA} status'
      attribute_templates:
        latitude: ${MOTION_CAMERA_LATITUDE}
        longitude: ${MOTION_CAMERA_LONGITUDE}
        entity_picture: /local/images/motion/${MOTION_CAMERA}/detected.jpg 
      icon_template: 'mdi:${MOTION_CAMERA_ICON}'
      value_template: >-
        {% set status = states('binary_sensor.motion_${MOTION_CAMERA}_status_camera') %}
        {% if status == 'on' %}
          {% set status = 'found' %}
        {% elif status == 'off' %}
          {% set status = 'lost' %}
        {% else %}
          {% set status = null %}
        {% endif %}
        {{- status -}}

###
## lost/found
###


## counters

# status counter
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_counter:
      friendly_name: '${MOTION_CAMERA} status counter'
      unit_of_measurement: count
      value_template: >-
        {{ states('sensor.motion_${MOTION_CAMERA}_status_camera_found_counter')|int - states('sensor.motion_status_camera_lost_counter')|int }}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_counter_mean:
      friendly_name: '${MOTION_CAMERA} status counter mean'
      unit_of_measurement: count
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_status_camera_counter_min:
      friendly_name: '${MOTION_CAMERA} status counter min'
      unit_of_measurement: count
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_status_camera_counter_max:
      friendly_name: '${MOTION_CAMERA} status counter max'
      unit_of_measurement: count
      value_template: >-
        {% if states('sensor.motion_status_camera_counter_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_status_camera_counter_stdev:
      friendly_name: '${MOTION_CAMERA} status counter stdev'
      unit_of_measurement: count
      value_template: >
        {% if states('sensor.motion_status_camera_counter_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_counter_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_${MOTION_CAMERA}_status_camera_counter_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_status_camera_counter
  sampling_size: 100
  max_age:
    hours: 72

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_found_counter:
      friendly_name: '${MOTION_CAMERA} found counter'
      unit_of_measurement: count
      value_template: >
        {% if states('counter.motion_${MOTION_CAMERA}_status_camera_found_counter') != 'unknown' %}
          {{ states('counter.motion_${MOTION_CAMERA}_status_camera_found_counter')|int }}
        {%- else -%}null{%- endif -%}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_lost_counter:
      friendly_name: '${MOTION_CAMERA} lost counter'
      unit_of_measurement: count
      value_template: >
        {% if states('counter.motion_${MOTION_CAMERA}_status_camera_lost_counter') != 'unknown' %}
          {{ states('counter.motion_${MOTION_CAMERA}_status_camera_lost_counter')|int }}
        {%- else -%}null{%- endif -%}

## found

- platform: mqtt
  name: motion_${MOTION_CAMERA}_status_camera_found
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/found'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/found'
  expire_after: !secret motion-expire-after
  force_update: true
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

# attributes (date, when)

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_found_date:
      unit_of_measurement: 's'
      value_template: >-
        {% if state_attr('sensor.motion_${MOTION_CAMERA}_status_camera_found','date')|lower != 'none'
              and states.sensor.motion_${MOTION_CAMERA}_status_camera_found.attributes.date|int > 0 %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_found.attributes.date|int }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_found_when:
      friendly_name: '${MOTION_CAMERA} found at'
      value_template: >-
        {% if states.sensor.motion_${MOTION_CAMERA}_status_camera_found_date|lower != 'none'
              and states.sensor.motion_${MOTION_CAMERA}_status_camera_found_date.state|int > 0 %}
          {% set s = states.sensor.motion_${MOTION_CAMERA}_status_camera_found_date.state|int %}
          {% set n = utcnow().timestamp() %}
          {{ s|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") -}}; {{ (n|int-s)|int }} lag
        {% else %}null{% endif %} 

## counter
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_status_camera_found_counter_mean:
#      friendly_name: 'status_camera_found counter ${MOTION_CAMERA} avg'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics.state|float }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_found_counter_min:
#      friendly_name: 'status_camera_found counter min'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_found_counter_max:
#      friendly_name: 'status_camera_found counter max'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_status_camera_found_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_found_counter_stdev:
#      friendly_name: 'status_camera_found counter stdev'
#      unit_of_measurement: count
#      value_template: >
#        {% if states('sensor.motion_status_camera_found_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_found_counter_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}
#
#- platform: statistics
#  name: motion_${MOTION_CAMERA}_status_camera_found_counter_statistics
#  entity_id: sensor.motion_${MOTION_CAMERA}_status_camera_found_counter
#  sampling_size: 100
#  max_age:
#    hours: 72

## lost

- platform: mqtt
  name: motion_${MOTION_CAMERA}_status_camera_lost
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/lost'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/lost'
  expire_after: !secret motion-expire-after
  force_update: true
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

# dates
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_lost_date:
      unit_of_measurement: 's'
      value_template: >-
        {% if state_attr('sensor.motion_${MOTION_CAMERA}_status_camera_lost','date')|lower != 'none'
              and states.sensor.motion_${MOTION_CAMERA}_status_camera_lost.attributes.date|int > 0 %}
          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_lost.attributes.date|int }}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_status_camera_lost_when:
      friendly_name: '${MOTION_CAMERA} lost at'
      value_template: >-
        {% if states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_date|lower != 'none'
              and states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_date.state|int > 0 %}
          {% set s = states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_date.state|int %}
          {{ s|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") -}}
        {% else %}null{% endif %} 

## counter
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_status_camera_lost_counter_mean:
#      friendly_name: 'status_camera_lost counter ${MOTION_CAMERA} avg'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics.state|float }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_lost_counter_min:
#      friendly_name: 'status_camera_lost counter min'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_lost_counter_max:
#      friendly_name: 'status_camera_lost counter max'
#      unit_of_measurement: count
#      value_template: >-
#        {% if states('sensor.motion_status_camera_lost_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_status_camera_lost_counter_stdev:
#      friendly_name: 'status_camera_lost counter stdev'
#      unit_of_measurement: count
#      value_template: >
#        {% if states('sensor.motion_status_camera_lost_counter_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}
#
#- platform: statistics
#  name: motion_${MOTION_CAMERA}_status_camera_lost_counter_statistics
#  entity_id: sensor.motion_${MOTION_CAMERA}_status_camera_lost_counter
#  sampling_size: 100
#  max_age:
#    hours: 72

###
# start event
###

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_start
  qos: 1
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/start'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/start'
  expire_after: !secret motion-expire-after
  force_update: true
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

###
# image event
###

#- platform: mqtt
#  name: motion_${MOTION_CAMERA}_event_image
#  qos: 1
#  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/image'
#  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/image'
#  expire_after: !secret motion-expire-after
#  force_update: true
#  value_template: >
#    {% if value_json is defined %}True{% else %}False{% endif %}

###
# end event
###

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_end
  qos: 2
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end'
  expire_after: !secret motion-end-expire-after
  force_update: !secret motion-end-force-update
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_annotated
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end/+'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end/+'
  expire_after: !secret motion-annotated-expire-after
  force_update: !secret motion-annotated-force-update
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_face
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/face/+'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/face/+'
  qos: 2
  expire_after: !secret motion-face-expire-after
  force_update: !secret motion-face-force-update
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_alpr
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/alpr/+'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/alpr/+'
  qos: 2
  expire_after: !secret motion-alpr-expire-after
  force_update: !secret motion-alpr-force-update
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

- platform: mqtt
  name: motion_${MOTION_CAMERA}_event_pose
  qos: 2
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/pose/+'
  json_attributes_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/pose/+'
  expire_after: !secret motion-pose-expire-after
  force_update: !secret motion-pose-force-update
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

## human readable
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_status:
      friendly_name: '${MOTION_CAMERA} motion end '
      value_template: >-
        {% if states('binary_sensor.motion_${MOTION_CAMERA}_end')|lower == 'on' %}
          {%- set e = states('sensor.motion_${MOTION_CAMERA}_event_end') -%}
          {% if e|lower != 'none' and e|lower != 'unknown' and e|lower != 'unavailable' and e|lower != 'null' and e is mapping %}
            Counter: {{ states('counter.motion_${MOTION_CAMERA}_end_counter') -}};
            {%- set device = state_attr('sensor.motion_${MOTION_CAMERA}_event_end','device') -%}
            {%- set camera = state_attr('sensor.motion_${MOTION_CAMERA}_event_end','camera') -%}
            {%- set event = state_attr('sensor.motion_${MOTION_CAMERA}_event_end','event') -%}
            {%- set end = state_attr('sensor.motion_${MOTION_CAMERA}_event_end','end') -%}
            {%- set elapsed = state_attr('sensor.motion_${MOTION_CAMERA}_event_end','elapsed')|int -%}
            {%- set when = end|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") -%}
            {%- if elapsed > 0 %} Duration: {{ elapsed }} seconds{%- else -%}None{%- endif -%};
            from: {{ device -}}/{{- camera -}}/{{- event -}}; at: {{ when -}}
          {% else %}Pending{% endif %}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_end_status') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}Pending{% endif %}
        {% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_camera_device:
      friendly_name: '${MOTION_CAMERA} device'
      value_template: >-
        {% if states('binary_sensor.motion_${MOTION_CAMERA}_end')|lower == 'on' %}
          {%- set e = states('sensor.motion_${MOTION_CAMERA}_event_end') -%}
          {% if e|lower != 'none' and e|lower != 'unknown' and e|lower != 'unavailable' and e|lower != 'null' and e is mapping %}
            {{ state_attr('sensor.motion_${MOTION_CAMERA}_event_end','device') }}
          {% else %}null{% endif %}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_camera_device') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}Pending{% endif %}
        {% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_camera_name:
      friendly_name: '${MOTION_CAMERA} name'
      value_template: >-
        {{ '${MOTION_CAMERA}' }}

## counting
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_counter:
      friendly_name: '${MOTION_CAMERA} end counter'
      unit_of_measurement: count
      value_template: >-
        {{ states('counter.motion_${MOTION_CAMERA}_end_counter')|int }}

## timing
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_date:
      unit_of_measurement: 's'
      value_template: >-
        {% if states.sensor.motion_${MOTION_CAMERA}_event_end|lower != 'none' 
              and state_attr('sensor.motion_${MOTION_CAMERA}_event_end','end')|lower != 'none' %}
          {% set date = states.sensor.motion_${MOTION_CAMERA}_event_end.attributes.end|int %}
          {% if date > 0 %}{{ date }}{% else %}null{% endif %}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_when:
      friendly_name: '${MOTION_CAMERA} end'
      value_template: >-
        {% set s = states('sensor.motion_${MOTION_CAMERA}_end_date')|int %}
        {% if s > 0 %}
          {{ s|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") -}}
        {% else %}Pending{% endif %}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_ago:
      friendly_name: '${MOTION_CAMERA} end ago'
      unit_of_measurement: 's'
      value_template: >
        {% set t = states('sensor.time') %}
        {% set s = states('sensor.motion_${MOTION_CAMERA}_end_date')|float %}
        {% if s >  0 %}
          {% set s = utcnow().timestamp()|float - s %}
          {% if s|int <  86400 %}{{ s|float }}{%- else -%}null{%- endif -%}
        {%- else -%}null{%- endif -%}

## elapsed
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_end_elapsed:
      value_template: >
        {% if states.sensor.motion_${MOTION_CAMERA}_event_end|lower != 'none'
              and state_attr('sensor.motion_${MOTION_CAMERA}_event_end','elapsed')|lower != 'none' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_event_end.attributes.elapsed }}
        {% else %}null{% endif %}

###
## annotated
###

## status
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_status:
      friendly_name: '${MOTION_CAMERA} annotated status'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated','on') or is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated_expired','off') %}
          {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
          {% if e|lower != 'none' and e|lower != 'unknown' and e|lower != 'unavailable' and e|lower != 'null' and e is mapping %}
            {% set n = utcnow().timestamp()|int %}
            {% set end = e.end|int %}
            {% set ago = n - end %}
            {% set event = e.event %}
            {% set device = e.device %}
            {% set camera = e.camera %}
            {% set elapsed = e.elapsed|int %}
            {% set what = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected')|map(attribute='entity')|list %}
            {% set count = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','count') %}
            {% set when = end|timestamp_custom("%a %b %d %I:%M:%S %p %Z") %}
            {% set delay = n - end %}
            ANNOTATED: {{ count }} {{ what }};
            from {{ device -}}/{{- camera -}}/{{- event -}};
            at {{ when }};
            ago: {{ ago }};
            delay: {{ delay }};
            duration: {{ elapsed }};
            counter: {{ states('counter.motion_${MOTION_CAMERA}_annotated_counter') -}}/{{- states('sensor.motion_annotated_counter') -}}
          {% else %}Pending{% endif %}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_annotated_status') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}Pending{% endif %}
        {% endif %}

## count
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_count:
      friendly_name: '${MOTION_CAMERA} annotated count'
      unit_of_measurement: entities
      value_template: >
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated','on') or is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated_expired','off') %}
          {% set count = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','count') %}
          {% if count|lower != 'none' and count|lower != 'unknown' and count != 'null' %}
            {{ count|int }}
          {% else %}null{% endif %}
        {% else %}null{% endif %}

## count_entity
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_count_entity:
      friendly_name: '${MOTION_CAMERA} annotated count entity'
      unit_of_measurement: entities
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated','on') or is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated_expired','off') %}
          {% set detected = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected') %}
          {% if detected|lower != 'none' and detected|lower != 'unknown' and detected != 'null' %}
            {% set count = detected|selectattr('entity','==',states('sensor.motion_${MOTION_CAMERA}_detect_entity'))|map(attribute='count')|sum %}
            {% if count|lower != 'none' and count|lower != 'unknown' and count != 'null' %}
              {{ count|int }}
            {% else %}null{% endif %}
          {% else %}null{% endif %}
        {% else %}null{% endif %}

## counts
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_counts:
      friendly_name: '${MOTION_CAMERA} annotated counts'
      value_template: >-
        {% set detected = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected') %}
        {% if detected|lower != 'none' and detected|lower != 'unknown' and detected|length > 0  %}
          {{ detected|map(attribute='count')|list }}
        {% else %}null{% endif %}

## list
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_list:
      friendly_name: '${MOTION_CAMERA} annotated entity list'
      value_template: >-
        {% set detected = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected') %}
        {% if detected|lower != 'none' and detected|lower != 'unknown' and detected|length > 0 %}
          {{ detected|map(attribute='entity')|list }}
        {% else %}null{% endif %}

## counter
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_counter:
      friendly_name: '${MOTION_CAMERA} annotated counter'
      unit_of_measurement: count
      value_template: >
        {{ states('counter.motion_${MOTION_CAMERA}_annotated_counter')|int }}

## date
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_date:
      unit_of_measurement: 's'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_annotated','on') %}
          {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
          {% if e is mapping %}
            {% set s = e.end %}
            {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' and s|int > 0 %}
              {{ s|int }}
            {%- else -%}null{%- endif -%}
          {%- else -%}null{%- endif -%}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_annotated_date') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}null{% endif %}
        {% endif %}

## when
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_when:
      friendly_name: '${MOTION_CAMERA} annotated when'
      value_template: >-
        {% set s = states('sensor.motion_${MOTION_CAMERA}_annotated_date')|int %}
        {% if s > 0 %}
          {{ s|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") -}}
        {% else %}Pending{% endif %}

## elapsed
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_elapsed:
      friendly_name: '${MOTION_CAMERA} annotated elapsed'
      unit_of_measurement: 's'
      value_template: >
        {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
        {% if e|lower != 'none' and e|lower != 'unknown' and e|lower != 'unavailable' and e|lower != 'null' and e is mapping %}
          {% set s = e.elapsed %}
          {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' %}
            {{ s|int }}
          {%- else -%}null{%- endif -%}
        {%- else -%}null{%- endif -%}

## delay

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_delay:
      friendly_name: '${MOTION_CAMERA} annotated delay'
      unit_of_measurement: 's'
      value_template: >
        {%- set s = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','timestamp') -%}
        {%- if s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'unknown' and s != null -%}
          {%- set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') -%}
          {%- if e|lower != 'unavailable' and e|lower != 'none' and e|lower != 'unknown' and e != null and e is iterable %}
            {%- set t = e.timestamp.end -%}
            {%- if t|lower != 'unavailable' and t|lower != 'none' and t|lower != 'unknown' and t != null and t|length > 0 %}
              {{- as_timestamp(s)|int - as_timestamp(t)|int }}
            {% else %}null{% endif %}
          {% else %}null{% endif %}
        {% else %}null{% endif %}

- platform: statistics
  name: motion_${MOTION_CAMERA}_annotated_delay_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_annotated_delay
  sampling_size: 100
  max_age:
    hours: 72

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_delay_mean:
      friendly_name: '${MOTION_CAMERA} delay avg'
      unit_of_measurement: 's'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics.state|float }}
        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_delay_min:
#      friendly_name: '${MOTION_CAMERA} delay min'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_delay_max:
#      friendly_name: '${MOTION_CAMERA} delay max'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_delay_stdev:
#      friendly_name: '${MOTION_CAMERA} delay stdev'
#      unit_of_measurement: 's'
#      value_template: >
#        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_delay_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}

## ago

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_ago_relative:
      friendly_name: '${MOTION_CAMERA} annotated ago relative'
      icon_template: 'mdi:eye'
      value_template: >
        {% set s = states('sensor.motion_${MOTION_CAMERA}_annotated_ago')|int %}
        {% if s > 0 %}
          {% set d = (s/86400)|int %}
          {% set h = (s/3600)|int %}
          {% if d < 1 %}
            {% set m = ((s-(d*86400)-(h*3600))/60)|int %}
            {% set s = (s % 60)|int %}
            {% if h < 1 %}
              {% if m < 1 %}
                {{ s -}}s
              {% else %}
                {{ m -}}m; {{ s -}}s
              {% endif %}
            {% else %}
              {{ h -}}h; {{ m -}}m
            {% endif %}
          {% else %}
            {{ d -}}d; {{ h -}}h
          {% endif %}
        {%- else -%}Pending{%- endif -%}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_ago:
      friendly_name: '${MOTION_CAMERA} annotated ago'
      unit_of_measurement: 's'
      value_template: >
        {%- set s = states('sensor.motion_${MOTION_CAMERA}_annotated_date') -%}
        {%- if s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' and s|lower != 'null' -%}
          {%- set s = utcnow().timestamp()|int - s|int -%}
          {{- s -}}
        {%- else -%}null{%- endif -%}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_ago_mean:
      friendly_name: '${MOTION_CAMERA} annotated ago avg'
      unit_of_measurement: 's'
      value_template: >-
        {% if states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics|lower != 'none' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics.state|float }}
        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_ago_min:
#      friendly_name: '${MOTION_CAMERA} annotated min'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_ago_max:
#      friendly_name: '${MOTION_CAMERA} annotated max'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_ago_stdev:
#      friendly_name: '${MOTION_CAMERA} annotated stdev'
#      unit_of_measurement: 's'
#      value_template: >
#        {% if states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_annotated_ago_change:
#      friendly_name: '${MOTION_CAMERA} annotated change'
#      unit_of_measurement: 's'
#      value_template: >
#        {% if states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_ago_statistics.attributes.change|float }}
#        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_${MOTION_CAMERA}_annotated_ago_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_annotated_ago
  sampling_size: 100
  max_age:
    hours: 72

## percent
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_percent:
      friendly_name: '${MOTION_CAMERA} annotated percent'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_counter')|int > 0 and states('sensor.motion_end_counter')|int > 0 %}
          {% set value = states.sensor.motion_${MOTION_CAMERA}_annotated_counter.state|int / states.sensor.motion_end_counter.state|int * 100.0 %}
          {{ "%.2f"|format(value|float) }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_${MOTION_CAMERA}_annotated_percent_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_annotated_percent
  sampling_size: 100
  max_age:
    hours: 72

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_annotated_percent_mean:
      friendly_name: '${MOTION_CAMERA} annotated percent avg'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_annotated_percent_min:
      friendly_name: '${MOTION_CAMERA} annotated percent min'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics.attributes.min_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_annotated_percent_max:
      friendly_name: '${MOTION_CAMERA} annotated percent max'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics.attributes.max_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_annotated_percent_stdev:
      friendly_name: '${MOTION_CAMERA} annotated percent stdev'
      unit_of_measurement: '%'
      value_template: >
        {% if states('sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_annotated_percent_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}

###
## detected
###

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_status:
      friendly_name: '${MOTION_CAMERA} detected status'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') %}
          {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
          {% if e is mapping %}
            {% set n = utcnow().timestamp()|int %}
            {% set end = e.end|int %}
            {% set event = e.event %}
            {% set device = e.device %}
            {% set camera = e.camera %}
            {% set elapsed = e.elapsed|int %}
            {% set what = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected')|map(attribute='entity')|list %}
            {% set count = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','count') %}
            {% set when = end|timestamp_custom("%a %b %d %I:%M:%S %p %Z") %}
            {% set delay = n - end %}
            {{ count }} entities: {{ what }};
            from {{ device -}}/{{- camera -}}/{{- event -}};
            at {{ when }};
            delay: {{ delay }};
            duration: {{ elapsed }};
            counter: {{ states('counter.motion_${MOTION_CAMERA}_detected_counter') -}}/{{- states('sensor.motion_detected_counter') -}}
          {% else %}Pending{% endif %}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_status') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}Pending{% endif %}
        {% endif %}

## count_entity
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_count_entity:
      friendly_name: '${MOTION_CAMERA} count entity'
      value_template: >-
        {% set s = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected')|selectattr('entity','==',states('sensor.motion_${MOTION_CAMERA}_detect_entity'))|map(attribute='count')|sum %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' %}
          {{ s|int }}
        {% else %}null{% endif %}

## counter
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_counter:
      friendly_name: '${MOTION_CAMERA} detected counter'
      unit_of_measurement: count
      value_template: >
        {{ states('counter.motion_${MOTION_CAMERA}_detected_counter')|int }}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_event:
      friendly_name: '${MOTION_CAMERA} detected event'
      unit_of_measurement: 's'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') %}
          {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
          {% if e is mapping %}
            {% set s = e.event %}
            {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' and s|int > 0 %}
              {{ s|int }}
            {%- else -%}null{%- endif -%}
          {%- else -%}null{%- endif -%}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_event') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}null{% endif %}
        {% endif %}

## date
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_date:
      friendly_name: '${MOTION_CAMERA} detected date'
      unit_of_measurement: 's'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') %}
          {% set e = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','event') %}
          {% if e is mapping %}
            {% set s = e.end %}
            {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' and s|int > 0 %}
              {{ s|int }}
            {%- else -%}null{%- endif -%}
          {%- else -%}null{%- endif -%}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_date') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}null{% endif %}
        {% endif %}

## when
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_when:
      friendly_name: '${MOTION_CAMERA} detected when'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_date') %}
          {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
            {% set p = s|int|timestamp_custom("%a %b %d %I:%M:%S %p %Z") %}
          {% endif %}
        {% endif %}
        {% if p is defined %}
          {{ p }}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_when') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'null' %}
            {{ s }}
          {% else %}Pending{% endif %}
        {% endif %}

## counts
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_counts:
      friendly_name: '${MOTION_CAMERA} detected counts'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') or is_state('binary_sensor.motion_${MOTION_CAMERA}_detected_expired','off') %}
          {{ states('sensor.motion_${MOTION_CAMERA}_annotated_counts') }}
        {%- else -%}null{%- endif -%}

## list
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_list:
      friendly_name: '${MOTION_CAMERA} detected list'
      value_template: >-
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') %}
          {% set s = state_attr('sensor.motion_${MOTION_CAMERA}_event_annotated','detected') %}
          {% if s|lower != 'none' and s|lower != 'unknown' and s|length > 0 %}
            {% set p = s|map(attribute='entity')|list %}
          {% endif %}
        {% endif %}
        {% if p is defined %}
          {{ p }}
        {% else %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_list') %}
          {% if s|lower != 'none' and s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' %}
            {{ s }}
          {% else %}null{% endif %}
        {% endif %}

## ago

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_ago_relative:
      friendly_name: '${MOTION_CAMERA} detected ago relative'
      icon_template: 'mdi:eye'
      value_template: >
        {% set s = states('sensor.motion_${MOTION_CAMERA}_detected_ago')|int %}
        {% if s > 0 %}
          {% set d = (s/86400)|int %}
          {% set h = (s/3600)|int %}
          {% if d < 1 %}
            {% set m = ((s-(d*86400)-(h*3600))/60)|int %}
            {% set s = (s % 60)|int %}
            {% if h < 1 %}
              {% if m < 1 %}
                {{ s -}}s
              {% else %}
                {{ m -}}m; {{ s -}}s
              {% endif %}
            {% else %}
              {{ h -}}h; {{ m -}}m
            {% endif %}
          {% else %}
            {{ d -}}d; {{ h -}}h
          {% endif %}
        {%- else -%}Pending{%- endif -%}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_ago:
      friendly_name: '${MOTION_CAMERA} detected ago'
      unit_of_measurement: 's'
      value_template: >
        {%- set s = states('sensor.motion_${MOTION_CAMERA}_detected_date') -%}
        {%- if s|lower != 'unavailable' and s|lower != 'unknown' and s|lower != 'none' and s|lower != 'null' -%}
          {%- set s = utcnow().timestamp()|int - s|int -%}
          {{- s -}}
        {%- else -%}null{%- endif -%}

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_ago_mean:
      friendly_name: '${MOTION_CAMERA} detected ago avg'
      unit_of_measurement: 's'
      value_template: >-
        {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics|lower != 'none' %}
          {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.state|int is number %}
            {{ states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.state|float }}
          {%- else -%}null{%- endif -%}
        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_ago_min:
#      friendly_name: '${MOTION_CAMERA} detected ago min'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_ago_max:
#      friendly_name: '${MOTION_CAMERA} detected ago max'
#      unit_of_measurement: 's'
#      value_template: >-
#        {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_ago_stdev:
#      friendly_name: '${MOTION_CAMERA} detected ago stdev'
#      unit_of_measurement: 's'
#      value_template: >
#        {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_ago_change:
#      friendly_name: '${MOTION_CAMERA} detected ago change'
#      unit_of_measurement: 's'
#      value_template: >
#        {% if states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics|lower != 'none' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_ago_statistics.attributes.change|float }}
#        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_${MOTION_CAMERA}_detected_ago_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_detected_ago
  sampling_size: 100
  max_age:
    hours: 72

# count
- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_count:
      friendly_name: '${MOTION_CAMERA} detected count'
      unit_of_measurement: entities
      value_template: >
        {% if is_state('binary_sensor.motion_${MOTION_CAMERA}_detected','on') or is_state('binary_sensor.motion_${MOTION_CAMERA}_detected_expired','off') %}
          {% set s = states('sensor.motion_${MOTION_CAMERA}_annotated_count') %}
          {% if s|lower != 'none' and s|lower != 'unknown' and s != 'null' %}
            {{ s|int }}
          {% else %}null{% endif %}
        {% else %}null{% endif %}

#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_detected_count_mean:
#      friendly_name: '${MOTION_CAMERA} detected avg'
#      unit_of_measurement: entities
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_detected_count_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_count_statistics.state|float }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_count_min:
#      friendly_name: '${MOTION_CAMERA} detected min'
#      unit_of_measurement: entities
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_detected_count_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_count_statistics.attributes.min_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_count_max:
#      friendly_name: '${MOTION_CAMERA} detected max'
#      unit_of_measurement: entities
#      value_template: >-
#        {% if states('sensor.motion_${MOTION_CAMERA}_detected_count_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_count_statistics.attributes.max_value|int }}
#        {%- else -%}null{%- endif -%}
#    motion_${MOTION_CAMERA}_detected_count_stdev:
#      friendly_name: '${MOTION_CAMERA} detected stdev'
#      unit_of_measurement: entities
#      value_template: >
#        {% if states('sensor.motion_${MOTION_CAMERA}_detected_count_statistics') != 'unknown' %}
#          {{ states.sensor.motion_${MOTION_CAMERA}_detected_count_statistics.attributes.standard_deviation|float }}
#        {%- else -%}null{%- endif -%}
#
#- platform: statistics
#  name: motion_${MOTION_CAMERA}_detected_count_statistics
#  entity_id: sensor.motion_${MOTION_CAMERA}_detected_count
#  sampling_size: 100
#  max_age:
#    hours: 72

## percent

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_percent:
      friendly_name: '${MOTION_CAMERA} detected percent'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_counter')|int > 0 and states('sensor.motion_annotated_counter')|int > 0 %}
          {% set value = states.sensor.motion_${MOTION_CAMERA}_detected_counter.state|int / states.sensor.motion_annotated_counter.state|int * 100.0 %}
          {{ "%.2f"|format(value|float) }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_${MOTION_CAMERA}_detected_percent_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_detected_percent
  sampling_size: 100
  max_age:
    hours: 72

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_percent_mean:
      friendly_name: '${MOTION_CAMERA} detected avg'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_percent_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_percent_min:
      friendly_name: '${MOTION_CAMERA} detected min'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_percent_statistics.attributes.min_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_percent_max:
      friendly_name: '${MOTION_CAMERA} detected max'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_percent_statistics.attributes.max_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_percent_stdev:
      friendly_name: '${MOTION_CAMERA} detected stdev'
      unit_of_measurement: '%'
      value_template: >
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_percent_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_percent_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}

###
## complete
###

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_complete:
      unit_of_measurement: 's'
      friendly_name: '${MOTION_CAMERA} complete'
      value_template: >
        {% set c = as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_annotated.last_updated) %}
        {% set s = as_timestamp(states.sensor.motion_${MOTION_CAMERA}_event_annotated.last_updated) %}
        {{  c|float - s|float }}

- platform: statistics
  name: motion_${MOTION_CAMERA}_detected_entity_complete_statistics
  entity_id: sensor.motion_${MOTION_CAMERA}_detected_entity_complete
  sampling_size: 100
  max_age:
    hours: 72

- platform: template
  sensors:
    motion_${MOTION_CAMERA}_detected_entity_complete_mean:
      friendly_name: '${MOTION_CAMERA} complete μ'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_entity_complete_min:
      friendly_name: '${MOTION_CAMERA} complete min'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics.attributes.min_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_entity_complete_max:
      friendly_name: '${MOTION_CAMERA} complete max'
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics.attributes.max_value|float }}
        {%- else -%}null{%- endif -%}
    motion_${MOTION_CAMERA}_detected_entity_complete_stdev:
      friendly_name: '${MOTION_CAMERA} complete stdev'
      unit_of_measurement: '%'
      value_template: >
        {% if states('sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics') != 'unknown' %}
          {{ states.sensor.motion_${MOTION_CAMERA}_detected_entity_complete_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}

## update camera
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_end_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_end.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_annotated_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_annotated.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_composite_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_composite.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_animated_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_animated.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_animated_mask_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_animated_mask.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_face_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_face.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_alpr_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_alpr.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_pose_update:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_pose.last_updated) }}

## again
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_end:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_end.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_annotated:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_annotated.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_composite:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_composite.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_animated:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_animated.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_animated_mask:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_animated_mask.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_face:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_face.last_updated) }}
#
#- platform: template
#  sensors:
#    motion_${MOTION_CAMERA}_camera_alpr:
#      value_template: >-
#        {{ as_timestamp(states.camera.motion_${MOTION_CAMERA}_event_alpr.last_updated) }}
#
