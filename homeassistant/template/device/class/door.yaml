###
# homeassistant/template/device/class/door.yaml
###

- unique_id: motion_device_door_max_spike
  trigger:
    - platform: state
      entity_id: sensor.motion_device_door_1w_max
  binary_sensor:
    - name: 'motion_device_door_max_spike'
      device_class: 'problem'
      attributes:
        max: >-
         {{ states.sensor.motion_device_door_max.attributes }}
      state: >-
        {% set now = states('sensor.motion_device_door_max') %}
        {% set mean = states('sensor.motion_device_door_max_1w_mean') %}
        {% set max = states('sensor.motion_device_door_max_1w_max') %}
        {% set stdev = states('sensor.motion_device_door_max_1w_stdev') %}
        {{ now|lower != 'unknown' and now|lower != 'null' and now|lower != 'none'
           and mean|lower != 'unknown' and mean|lower != 'null'and mean|lower != 'none'
           and max|lower != 'unknown' and max|lower != 'null' and max|lower != 'none'
           and stdev|lower != 'unknown' and stdev|lower != 'null' and stdev|lower != 'none'
           and ( now|float(0.0) > (mean|float(0.0) + stdev|float(0.0)) or now|float(0.0) > (max|float(0.0) - stdev|float(0.0)) ) }}

- unique_id: motion_device_door_min_spike
  trigger:
    - platform: state
      entity_id: sensor.motion_device_door_1w_min
  binary_sensor:
    - name: 'motion_device_door_min_spike'
      device_class: 'problem'
      attributes:
        max: >-
         {{ states.sensor.motion_device_door_min.attributes }}
      state: >-
        {% set now = states('sensor.motion_device_door_min') %}
        {% set mean = states('sensor.motion_device_door_min_1w_mean') %}
        {% set max = states('sensor.motion_device_door_min_1w_max') %}
        {% set stdev = states('sensor.motion_device_door_min_1w_stdev') %}
        {{ now|lower != 'unknown' and now|lower != 'null' and now|lower != 'none'
           and mean|lower != 'unknown' and mean|lower != 'null'and mean|lower != 'none'
           and max|lower != 'unknown' and max|lower != 'null' and max|lower != 'none'
           and stdev|lower != 'unknown' and stdev|lower != 'null' and stdev|lower != 'none'
           and ( now|float(0.0) > (mean|float(0.0) + stdev|float(0.0)) or now|float(0.0) > (max|float(0.0) - stdev|float(0.0)) ) }}
