###
# homeassistant/template/notification.yaml
###

- unique_id: motion_alarm_measurement
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'count'
  sensor:
    - name: 'motion_alarm_measurement'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {{- state_attr('binary_sensor.motion_alarm','count')|int(none) -}}

- unique_id: motion_alarm_measurement_bad
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'bad'
  sensor:
    - name: 'motion_alarm_measurement_bad'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','bad') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_good
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'good'
  sensor:
    - name: 'motion_alarm_measurement_good'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','good') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_high
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'high'
  sensor:
    - name: 'motion_alarm_measurement_high'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','high') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_low
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'low'
  sensor:
    - name: 'motion_alarm_measurement_low'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','low') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_unavailable
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'unavailable'
  sensor:
    - name: 'motion_alarm_measurement_unavailable'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','unavailable') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_missing
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'missing'
      entity_id: binary_sensor.motion_alarm_missing
      to: 'on'
  sensor:
    - name: 'motion_alarm_measurement_missing'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','missing') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_found
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'found'
      entity_id: binary_sensor.motion_alarm_found
      to: 'on'
  sensor:
    - name: 'motion_alarm_measurement_found'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','found') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}

- unique_id: motion_alarm_measurement_activity
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_alarm
      attribute: 'activity'
      entity_id: binary_sensor.motion_alarm_activity
      to: 'on'
  sensor:
    - name: 'motion_alarm_measurement_activity'
      state_class: 'measurement'
      device_class: 'power_factor'
      unit_of_measurement: '%'
      state: >-
        {%- set s = state_attr('binary_sensor.motion_alarm','activity') -%}
        {%- if s|lower != 'none' and not s is string and s is iterable -%}
          {{- s|count -}}
        {%- else -%}null{%- endif -%}
