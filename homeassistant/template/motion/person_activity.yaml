###
# homeassistant/template/motion/person_activity.yaml
###

- unique_id: motion_person_active_duration_measurement
  trigger:
    - platform: state
      entity_id: 'sensor.motion_person_active'
      attribute: duration
  sensor:
    - name: 'motion_person_active_duration_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('sensor.motion_person_active','duration') %}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{ '%0.1f'|format(s) }}
        {%- else -%}null{%- endif -%}

- unique_id: motion_person_active_ago_measurement
  trigger:
    - platform: state
      entity_id: 'sensor.motion_person_active'
      attribute: start
    - platform: time_pattern
      minutes: '/1'
  sensor:
    - name: 'motion_person_active_ago_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('sensor.motion_person_active','start') %}
        {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
          {{ '%0.1f'|format(utcnow().timestamp() - s) }}
        {%- else -%}
          {% set s = state_attr('sensor.motion_person_active','end') %}
          {%- if s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'none' and s|lower != 'null' -%}
            {{ '%0.1f'|format(utcnow().timestamp() - s) }}
          {%- else -%}null{%- endif -%}
        {%- endif -%}

- unique_id: motion_person_active_probability
  trigger:
    - platform: state
      entity_id: 'binary_sensor.motion_person_active'
      attribute: probability
  sensor:
    - name: 'motion_person_active_probability_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_active','probability') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}
    - name: 'motion_person_active_probability_threshold'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_active','probability_threshold') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}

- unique_id: motion_person_occupancy_active
  trigger:
    - platform: state
      entity_id: 'binary_sensor.motion_person_occupancy_active'
      attribute: probability
  sensor:
    - name: 'motion_person_occupancy_active_probability_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_occupancy_active','probability') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}
    - name: 'motion_person_occupancy_active_probability_threshold'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_occupancy_active','probability_threshold') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}

- unique_id: motion_person_location_active
  trigger:
    - platform: state
      entity_id: 'binary_sensor.motion_person_location_active'
      attribute: probability
  sensor:
    - name: 'motion_person_location_active_probability_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_location_active','probability') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}
    - name: 'motion_person_location_active_probability_threshold'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_location_active','probability_threshold') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}

- unique_id: motion_person_detected_active
  trigger:
    - platform: state
      entity_id: 'binary_sensor.motion_person_detected_active'
      attribute: probability
  sensor:
    - name: 'motion_person_detected_active_probability_measurement'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_detected_active','probability') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}
    - name: 'motion_person_detected_active_probability_threshold'
      state_class: 'measurement'
      device_class: 'pressure'
      unit_of_measurement: 'psi'
      state: >-
        {% set s = state_attr('binary_sensor.motion_person_detected_active','probability_threshold') %}
        {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
          {{ s }}
        {% else %}null{% endif %}
