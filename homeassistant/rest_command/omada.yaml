###
# homeassistant/rest_command/omada.yaml
###

# curl --anyauth -k "https://192.168.1.40:8043/api/v2/login" -X POST --header "Content-type: application/json" -d '{"username":"dcmartin","password":"hali4@ian"}'
# Cookie: TPEAP_SESSIONID=704ecbb0-5ace-4eee-b779-0c99d360a8e8; Path=/; Secure; HttpOnly

omada_login:
  method: PUT
  verify_ssl: false
  content-type: 'application/json'
  url: >-
    {% set s = state_attr('sensor.omada','url') %}
    {% if s|lower != 'none' and s|lower != 'unknown' and s|lower != 'unavailable' and s|lower != 'null' %}
      {{ s|string + '/api/v2/login' }}
    {% else %}null{% endif %}
  payload: >-
    {% set u = state_attr('sensor.omada','username') %}
    {% set p = state_attr('sensor.omada','password') %}
    {% if u|lower != 'none' and u|lower != 'unknown' and u|lower != 'unavailable' and u|lower != 'null' 
         and p|lower != 'none' and p|lower != 'unknown' and p|lower != 'unavailable' and p|lower != 'null' %}
      {{ '{"username":"' + u|string + '","password":"' + p|string + '"}' }}
    {% else %}null{% endif %}
