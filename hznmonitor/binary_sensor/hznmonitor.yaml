###
### HZNMONITOR BINARY_SENSOR
###

  - platform: template
    sensors:
      ## state
      hznmonitor_event_state:
        entity_id:
          - sensor.hznmonitor_event_latest_id
          - sensor.hznmonitor_event_ago
        value_template: >
          {{ states.sensor.hznmonitor_event.state }}
      ## nodes tracking
      hznmonitor_nodes_low:
        entity_id:
          - sensor.hznmonitor_exchange_nodes
          - sensor.hznmonitor_exchange_nodes_statistics
          - input_number.hznmonitor_exchange_nodes_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_nodes_statistics.attributes.standard_deviation|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_nodes_statistics.state|float) - (states.sensor.hznmonitor_exchange_nodes.state|float))
                 / (states.sensor.hznmonitor_exchange_nodes_statistics.attributes.standard_deviation|float)
               > (states.input_number.hznmonitor_exchange_nodes_deviation.state|float)) }}
          {%- else -%}false{%- endif -%}
        icon_template: >
            mdi:emoticon-sad
      hznmonitor_nodes_low_persistent:
        entity_id:
          - sensor.hznmonitor_exchange_nodes
          - sensor.hznmonitor_exchange_nodes_stdev_mean
          - input_number.hznmonitor_exchange_nodes_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_nodes_stdev_mean.state|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_nodes_statistics.state|float) - (states.sensor.hznmonitor_exchange_nodes.state|float))
                 / (states.sensor.hznmonitor_exchange_nodes_stdev_mean.state|float)
               > (states.input_number.hznmonitor_exchange_nodes_deviation.state|float)) }}
          {%- else -%}false{%- endif -%}
        icon_template: >
            mdi:emoticon-sad
      hznmonitor_nodes_high:
        entity_id:
          - sensor.hznmonitor_exchange_nodes
          - sensor.hznmonitor_exchange_nodes_statistics
          - input_number.hznmonitor_exchange_nodes_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_nodes_statistics.attributes.standard_deviation|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_nodes.state|float) - (states.sensor.hznmonitor_exchange_nodes_statistics.state|float))
                 / (states.sensor.hznmonitor_exchange_nodes_statistics.attributes.standard_deviation|float))
               > (states.input_number.hznmonitor_exchange_nodes_deviation.state|float) }}
          {%- else -%}false{%- endif -%}
        icon_template: >-
            mdi:emoticon-happy
      hznmonitor_nodes_high_persistent:
        entity_id:
          - sensor.hznmonitor_exchange_nodes
          - sensor.hznmonitor_exchange_nodes_stdev_mean
          - input_number.hznmonitor_exchange_nodes_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_nodes_stdev_mean.state|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_nodes.state|float) - (states.sensor.hznmonitor_exchange_nodes_statistics.state|float))
                 / (states.sensor.hznmonitor_exchange_nodes_stdev_mean.state|float))
               > (states.input_number.hznmonitor_exchange_nodes_deviation.state|float) }}
          {%- else -%}false{%- endif -%}
        icon_template: >-
            mdi:emoticon-happy
      ## users tracking
      hznmonitor_users_low:
        entity_id:
          - sensor.hznmonitor_exchange_users
          - sensor.hznmonitor_exchange_users_statistics
          - input_number.hznmonitor_exchange_users_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_users_statistics.attributes.standard_deviation|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_users_statistics.state|float) - (states.sensor.hznmonitor_exchange_users.state|float))
                 / (states.sensor.hznmonitor_exchange_users_statistics.attributes.standard_deviation|float)
               > (states.input_number.hznmonitor_exchange_users_deviation.state|float)) }}
          {%- else -%}false{%- endif -%}
        icon_template: >
            mdi:emoticon-sad
      hznmonitor_users_low_persistent:
        entity_id:
          - sensor.hznmonitor_exchange_users
          - sensor.hznmonitor_exchange_users_stdev_mean
          - input_number.hznmonitor_exchange_users_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_users_stdev_mean.state|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_users_statistics.state|float) - (states.sensor.hznmonitor_exchange_users.state|float))
                 / (states.sensor.hznmonitor_exchange_users_stdev_mean.state|float)
               > (states.input_number.hznmonitor_exchange_users_deviation.state|float)) }}
          {%- else -%}false{%- endif -%}
        icon_template: >
            mdi:emoticon-sad
      hznmonitor_users_high:
        entity_id:
          - sensor.hznmonitor_exchange_users
          - sensor.hznmonitor_exchange_users_statistics
          - input_number.hznmonitor_exchange_users_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_users_statistics.attributes.standard_deviation|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_users.state|float) - (states.sensor.hznmonitor_exchange_users_statistics.state|float))
                 / (states.sensor.hznmonitor_exchange_users_statistics.attributes.standard_deviation|float))
               > (states.input_number.hznmonitor_exchange_users_deviation.state|float) }}
          {%- else -%}false{%- endif -%}
        icon_template: >-
            mdi:emoticon-happy
      hznmonitor_users_high_persistent:
        entity_id:
          - sensor.hznmonitor_exchange_users
          - sensor.hznmonitor_exchange_users_stdev_mean
          - input_number.hznmonitor_exchange_users_deviation
        value_template: >-
          {% if states.sensor.hznmonitor_exchange_users_stdev_mean.state|float > 0 %}
            {{ (((states.sensor.hznmonitor_exchange_users.state|float) - (states.sensor.hznmonitor_exchange_users_statistics.state|float))
                 / (states.sensor.hznmonitor_exchange_users_stdev_mean.state|float))
               > (states.input_number.hznmonitor_exchange_users_deviation.state|float) }}
          {%- else -%}false{%- endif -%}
        icon_template: >-
            mdi:emoticon-happy
