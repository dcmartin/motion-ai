###
### ${MOTION_CAMERA} sensors
###

###
# found
###

- platform: mqtt
  name: motion_status_camera_found_${MOTION_CAMERA}
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/found'
  expire_after: 86400
  force_update: true
  json_attributes:
    - device
    - camera
    - date
    - status
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

## dates
- platform: template
  sensors:
    motion_status_camera_found_date_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_status_camera_found_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% if state_attr('sensor.motion_status_camera_found_${MOTION_CAMERA}','date') != none
              and states.sensor.motion_status_camera_found_${MOTION_CAMERA}.attributes.date|int > 0 %}
          {{ states.sensor.motion_status_camera_found_${MOTION_CAMERA}.attributes.date|int }}
        {% else %}{{ now().timestamp()|int }}{% endif %}
    motion_status_camera_found_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} found
      entity_id:
        - sensor.motion_status_camera_found_date_${MOTION_CAMERA}
      value_template: >-
        {% if states.sensor.motion_status_camera_found_date_${MOTION_CAMERA} != none
              and states.sensor.motion_status_camera_found_date_${MOTION_CAMERA}.state|int > 0 %}
          {{ states.sensor.motion_status_camera_found_date_${MOTION_CAMERA}.state|int|timestamp_custom("%a %b %d ~ %I:%M %p") }}
        {% else %}null{% endif %} 

###
# lost
###

- platform: mqtt
  name: motion_status_camera_lost_${MOTION_CAMERA}
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/status/lost'
  expire_after: 86400
  force_update: true
  json_attributes:
    - device
    - camera
    - date
    - status
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

## dates
- platform: template
  sensors:
    motion_status_camera_lost_date_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_status_camera_lost_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% if state_attr('sensor.motion_status_camera_lost_${MOTION_CAMERA}','date') != none
              and states.sensor.motion_status_camera_lost_${MOTION_CAMERA}.attributes.date|int > 0 %}
          {{ states.sensor.motion_status_camera_lost_${MOTION_CAMERA}.attributes.date|int }}
        {% else %}now().timestamp()|int{% endif %}
    motion_status_camera_lost_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} lost
      entity_id:
        - sensor.motion_status_camera_lost_date_${MOTION_CAMERA}
      value_template: >-
        {% if states.sensor.motion_status_camera_lost_date_${MOTION_CAMERA} != none
              and states.sensor.motion_status_camera_lost_date_${MOTION_CAMERA}.state|int > 0 %}
          {{ states.sensor.motion_status_camera_lost_date_${MOTION_CAMERA}.state|int|timestamp_custom("%a %b %d ~ %I:%M %p") }}
        {% else %}null{% endif %} 

## EVENT IMAGE - ${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/image
- platform: mqtt
  name: motion_image_${MOTION_CAMERA}
  qos: 1
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/image'
  expire_after: 1
  force_update: true
  json_attributes:
    - device
    - camera
    - type
    - date
    - seqno
    - event
    - id
    - center
    - width
    - height
    - size
    - noise
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

## START EVENT
- platform: mqtt
  name: motion_start_${MOTION_CAMERA}
  qos: 1
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/start'
  expire_after: 15
  force_update: true
  json_attributes:
    - device
    - camera
    - event
    - start
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

###
# end
###

- platform: mqtt
  name: motion_event_end_${MOTION_CAMERA}
  qos: 2
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end'
  expire_after: 45
  force_update: True
  json_attributes:
    - device
    - camera
    - event
    - start
    - end
    - elapsed
    - date
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

- platform: template
  sensors:
    ## status
    motion_end_status_${MOTION_CAMERA}:
      friendly_name: Movement_${MOTION_CAMERA}
      entity_id:
        - sensor.motion_end_counter_${MOTION_CAMERA}
        - sensor.motion_end_ago_${MOTION_CAMERA}
        - sensor.motion_end_elapsed_${MOTION_CAMERA}
        - sensor.motion_end_device_${MOTION_CAMERA}
        - sensor.motion_end_camera_${MOTION_CAMERA}
        - sensor.motion_end_when_${MOTION_CAMERA}
      value_template: >-
        {% set device = states('sensor.motion_end_device_${MOTION_CAMERA}') %}
        {% set camera = states('sensor.motion_end_camera_${MOTION_CAMERA}') %}
        {% set elapsed = states('sensor.motion_end_elapsed_${MOTION_CAMERA}')|int %}
        {% set ago = states('sensor.motion_end_ago_${MOTION_CAMERA}')|int %}
        {% set when = states('sensor.motion_end_when_${MOTION_CAMERA}') %}
        {% if elapsed > 0 %} {{ elapsed }} {% else %} zero {% endif %} second(s);
        {{ device -}}/{{- camera }};
        {{ when }}; {{ ago }} second(s) ago

## timing
- platform: template
  sensors:
    motion_end_date_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_end_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% set date = states.sensor.motion_event_end_${MOTION_CAMERA}.attributes.event.end|int %}
        {% if date > 0 %}{{ date }} {% else %}null{% endif %}
    motion_end_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} end
      entity_id:
        - sensor.motion_end_date_${MOTION_CAMERA}
      value_template: >-
        {% set date = states('sensor.motion_detected_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %} {{ date|timestamp_custom("%a %b %d ~ %I:%M %p") }} {% else %}never{% endif %}
    motion_end_ago_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} end ago
      entity_id:
        - sensor.motion_end_date_${MOTION_CAMERA}
        - sun.sun
      unit_of_measurement: seconds
      value_template: >
        {% set s = states('sensor.motion_end_date_${MOTION_CAMERA}')|int %}
        {% if s > 0 %}{% now().timestamp()|int - s %}{%- else -%}null{%- endif -%}

## counting
- platform: template
  sensors:
    motion_end_counter_${MOTION_CAMERA}:
      entity_id:
        - counter.motion_end_counter_${MOTION_CAMERA}
      unit_of_measurement: count
      value_template: >-
        {% if states.counter.motion_end_counter_${MOTION_CAMERA} != none %}
          {{ states.counter.motion_end_counter_${MOTION_CAMERA}.state|int }}
        {%- else -%}null{%- endif -%}

## attributes
- platform: template
  sensors:
    motion_end_device_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_end_${MOTION_CAMERA}
      value_template: >
        {% if states.sensor.motion_event_end_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_end_${MOTION_CAMERA}','device') != none %}
          {{ states.sensor.motion_event_end_${MOTION_CAMERA}.attributes.device }}
        {% else %} null {% endif %}
    motion_end_camera_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_end_${MOTION_CAMERA}
      value_template: >
        {% if states.sensor.motion_event_end_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_end_${MOTION_CAMERA}','camera') != none %}
          {{ states.sensor.motion_event_end_${MOTION_CAMERA}.attributes.camera }}
        {% else %} null {% endif %}
    motion_end_elapsed_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_end_${MOTION_CAMERA}
      value_template: >
        {% if states.sensor.motion_event_end_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_end_${MOTION_CAMERA}','elapsed') != none %}
          {{ states.sensor.motion_event_end_${MOTION_CAMERA}.attributes.elapsed }}
        {% else %} null {% endif %}

###
## annotated
###

## event_annotated
- platform: mqtt
  name: motion_event_annotated_${MOTION_CAMERA}
  state_topic: '${MOTION_GROUP}/${MOTION_CLIENT}/${MOTION_CAMERA}/event/end/+'
  expire_after: 45
  force_update: true
  json_attributes:
    - timestamp
    - date
    - time
    - count
    - event
    - info
    - detected
  value_template: >
    {% if value_json is defined %}True{% else %}False{% endif %}

## status
- platform: template
  sensors:
    motion_annotated_status_${MOTION_CAMERA}:
      friendly_name: Annotated_${MOTION_CAMERA}
      entity_id:
        - sensor.motion_annotated_when_${MOTION_CAMERA}
        - sensor.motion_annotated_camera_${MOTION_CAMERA}
        - sensor.motion_annotated_device_${MOTION_CAMERA}
        - sensor.motion_annotated_counter_${MOTION_CAMERA}
        - sensor.motion_annotated_count_${MOTION_CAMERA}
        - sensor.motion_annotated_entity_list_${MOTION_CAMERA}
        - sensor.motion_annotated_ago_${MOTION_CAMERA}
      value_template: >-
        {% set count = states('sensor.motion_annotated_count_${MOTION_CAMERA}')|int %}
        {% set saw = states('sensor.motion_annotated_entity_list_${MOTION_CAMERA}') %}
        {% set device = states('sensor.motion_annotated_device_${MOTION_CAMERA}') %}
        {% set camera = states('sensor.motion_annotated_camera_${MOTION_CAMERA}') %}
        {% set ago = states('sensor.motion_annotated_ago_${MOTION_CAMERA}')|int %}
        {% set when = states('sensor.motion_annotated_when_${MOTION_CAMERA}') %}
        {% if count > 0 %}{{ count }} entity(s): {{ saw -}};{% else %}nothing;{% endif %}
        {{ device -}}/{{- camera }};
        {{ when }}; {{ ago }} second(s) ago

## timing
- platform: template
  sensors:
    # date
    motion_annotated_date_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% set date = states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.end|int %}
        {% if date > 0 %}{{ date }} {% else %}null{% endif %}
    # human readable
    motion_annotated_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated
      entity_id:
        - sensor.motion_annotated_date_${MOTION_CAMERA}
      value_template: >-
        {% set date = states('sensor.motion_detected_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %} {{ date|timestamp_custom("%a %b %d ~ %I:%M %p") }} {% else %}never{% endif %}

## attributes
- platform: template
  sensors:
    motion_annotated_device_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      value_template: >
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','device') != none %}
          {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.device }}
        {% else %} null {% endif %}
    motion_annotated_camera_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      value_template: >
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','camera') != none %}
          {{ states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.camera }}
        {% else %} null {% endif %}

## entity counter
- platform: template
  sensors:
    motion_annotated_count_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated count
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      unit_of_measurement: entities
      value_template: >
        {% if state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','count') != none %}
          {{ state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','count')|int }}
        {% else %}null{% endif %}
    motion_annotated_entity_count_${MOTION_CAMERA}:
      friendly_name: Annotated entity count
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      unit_of_measurement: entities
      value_template: >-
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','detected') != none
              and states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.count|int > 0 %}
          {% for detected in states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.detected %}
            {% if detected.entity == states.sensor.motion_detect_entity.state and detected.count|int > 0 %}
              {{ detected.count }}
            {% endif %}
          {% endfor %}
        {% else %}null{% endif %}
    motion_annotated_entity_list_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated entity list
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      value_template: >-
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','count') != none
              and states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.count|int > 0 %}
          {% for detected in states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.detected %}
            {%- if loop.first -%}{%- else -%},{%- endif -%}
            {{- detected.entity -}}
          {% endfor %}
        {% else %}null{% endif %}

## counting
- platform: template
  sensors:
    motion_annotated_counter_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated counter
      entity_id:
        - counter.motion_annotated_counter_${MOTION_CAMERA}
      unit_of_measurement: count
      value_template: >
        {% if states('counter.motion_annotated_counter_${MOTION_CAMERA}') != 'unknown' %}
          {{ states('counter.motion_annotated_counter_${MOTION_CAMERA}')|int }}
        {%- else -%}null{%- endif -%}

## ago
- platform: template
  sensors:
    motion_annotated_ago_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated ago
      entity_id:
        - sensor.motion_annotated_date_${MOTION_CAMERA}
        - sun.sun
      unit_of_measurement: seconds
      value_template: >
        {% set s = states('sensor.motion_annotated_date_${MOTION_CAMERA}')|int %}
        {% if s > 0 %}{% now().timestamp()|int - s %}{%- else -%}null{%- endif -%}
    # statistics
    motion_annotated_ago_${MOTION_CAMERA}_mean:
      friendly_name: ${MOTION_CAMERA} annotated ago avg
      entity_id:
        - sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_ago_${MOTION_CAMERA}_min_value:
      friendly_name: ${MOTION_CAMERA} annotated min
      entity_id:
        - sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_annotated_ago_${MOTION_CAMERA}_max_value:
      friendly_name: ${MOTION_CAMERA} annotated max
      entity_id:
        - sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_annotated_ago_${MOTION_CAMERA}_stdev:
      friendly_name: ${MOTION_CAMERA} annotated stdev
      entity_id:
        - sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_ago_${MOTION_CAMERA}_change_rate:
      friendly_name: ${MOTION_CAMERA} annotated change
      entity_id:
        - sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_annotated_ago_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}
# statistics
- platform: statistics
  name: motion_annotated_ago_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_annotated_ago_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24

- platform: statistics
  name: motion_annotated_ago_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_annotated_ago_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

## percent
- platform: template
  sensors:
    # percent of motion events which were annotated
    motion_annotated_percent_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} annotated
      entity_id:
        - counter.motion_end_counter_${MOTION_CAMERA}
        - counter.motion_annotated_counter_${MOTION_CAMERA}
      unit_of_measurement: '%'
      value_template: >-
        {% if states('counter.motion_annotated_counter_${MOTION_CAMERA}')|int > 0 and states('counter.motion_end_counter_${MOTION_CAMERA}')|int > 0 %}
          {{  ( states.counter.motion_annotated_counter_${MOTION_CAMERA}.state|int / states.counter.motion_end_counter_${MOTION_CAMERA}.state|int ) * 100.0 }}
        {%- else -%}null{%- endif -%}
    # derived annotated percent_${MOTION_CAMERA} statistics
    motion_annotated_percent_${MOTION_CAMERA}_mean:
      friendly_name: ${MOTION_CAMERA} annotated avg
      entity_id:
        - sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_percent_${MOTION_CAMERA}_min_value:
      friendly_name: ${MOTION_CAMERA} annotated min
      entity_id:
        - sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics.attributes.min_value|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_percent_${MOTION_CAMERA}_max_value:
      friendly_name: ${MOTION_CAMERA} annotated max
      entity_id:
        - sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics
      unit_of_measurement: '%'
      value_template: >-
        {% if states('sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics.attributes.max_value|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_percent_${MOTION_CAMERA}_stdev:
      friendly_name: ${MOTION_CAMERA} annotated stdev
      entity_id:
        - sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics
      unit_of_measurement: '%'
      value_template: >
        {% if states('sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_percent_${MOTION_CAMERA}_change_rate:
      friendly_name: ${MOTION_CAMERA} annotated change
      entity_id:
        - sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics
      unit_of_measurement: '%'
      value_template: >
        {% if states('sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_percent_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_annotated_percent_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_annotated_percent_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24
- platform: statistics
  name: motion_annotated_percent_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_annotated_percent_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

## delay 
- platform: template
  sensors:
    motion_annotated_delay_${MOTION_CAMERA}:
      friendly_name: Annotated delay ${MOTION_CAMERA}
      entity_id:
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','event') != none %}
          {{ now().timestamp()|int - states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.event.date|int }}
        {% else %}null{% endif %}
    # statistics
    motion_annotated_delay_${MOTION_CAMERA}_mean:
      friendly_name: Annotated delay avg
      entity_id:
        - sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states('sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_delay_${MOTION_CAMERA}_min_value:
      friendly_name: Annotated delay min
      entity_id:
        - sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states('sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_annotated_delay_${MOTION_CAMERA}_max_value:
      friendly_name: Annotated delay max
      entity_id:
        - sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states('sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_annotated_delay_${MOTION_CAMERA}_stdev:
      friendly_name: Annotated delay stdev
      entity_id:
        - sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states('sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_annotated_delay_${MOTION_CAMERA}_change_rate:
      friendly_name: Annotated delay change
      entity_id:
        - sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states('sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_annotated_delay_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}

- platform: statistics
  name: motion_annotated_delay_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_annotated_delay_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24
- platform: statistics
  name: motion_annotated_delay_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_annotated_delay_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

###
## detected
###

## status
- platform: template
  sensors:
    motion_detected_status_${MOTION_CAMERA}:
      friendly_name: Saw
      entity_id:
        - sensor.motion_detected_device_${MOTION_CAMERA}
        - sensor.motion_detected_camera_${MOTION_CAMERA}
        - sensor.motion_detected_count_${MOTION_CAMERA}
        - sensor.motion_detected_when_${MOTION_CAMERA}
        - counter.motion_detected_counter_${MOTION_CAMERA}
        - sensor.motion_detected_ago_${MOTION_CAMERA}
        - sensor.motion_annotated_entity_count_${MOTION_CAMERA}
      value_template: >-
        {% set count = states('sensor.motion_detected_count_${MOTION_CAMERA}')|int %}
        {% set entities = states('sensor.motion_annotated_entity_count_${MOTION_CAMERA}')|int %}
        {% set device = states('sensor.motion_detected_device_${MOTION_CAMERA}') %}
        {% set camera = states('sensor.motion_detected_camera_${MOTION_CAMERA}') %}
        {% set ago = states('sensor.motion_detected_ago_${MOTION_CAMERA}') %}
        {% set when = states('sensor.motion_detected_when_${MOTION_CAMERA}') %}
        {% if count > 0 %}
          {{ count }} entity(s);
          {% if entities > 0 %}{{ entities }}{% else %}zero{% endif %}
          {{ states('sensor.motion_detect_entity') -}}(s);
        {% else %}nothing{% endif %}
        {{ device -}}/{{- camera }};
        {{ when }}; {{ ago }} second(s) ago

## timing
- platform: template
  sensors:
    motion_detected_date_${MOTION_CAMERA}:
      entity_id:
        - counter.motion_detected_counter_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% set date = states('sensor.motion_annotated_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %}{{ date }} {% else %}null{% endif %}
    # human readable
    motion_detected_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected at
      entity_id:
        - sensor.motion_detected_date_${MOTION_CAMERA}
      value_template: >-
        {% set date = states('sensor.motion_detected_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %} {{ date|timestamp_custom("%a %b %d ~ %I:%M %p") }} {% else %}never{% endif %}

## counting
- platform: template
  sensors:
    motion_detected_counter_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected counter
      entity_id:
        - counter.motion_detected_counter_${MOTION_CAMERA}
      unit_of_measurement: count
      value_template: >
        {% if states('counter.motion_detected_counter_${MOTION_CAMERA}') != 'unknown' %}
          {{ states('counter.motion_detected_counter_${MOTION_CAMERA}')|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_count_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected count
      entity_id:
        - counter.motion_detected_counter_${MOTION_CAMERA}
      unit_of_measurement: entities
      value_template: >-
        {% if states.sensor.motion_annotated_count_${MOTION_CAMERA} != none
              and states.sensor.motion_annotated_count_${MOTION_CAMERA}.state|int is number %}
          {{ states.sensor.motion_annotated_count_${MOTION_CAMERA}.state|int }}
        {% else %}null{% endif %}

## ago
- platform: template
  sensors:
    motion_detected_ago_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected ago
      entity_id:
        - sensor.motion_detected_date_${MOTION_CAMERA}
        - sun.sun
      unit_of_measurement: seconds
      value_template: >
        {% set s = states('sensor.motion_detected_date_${MOTION_CAMERA}')|int %}
        {% if s > 0 %}{% now().timestamp()|int - s %}{%- else -%}null{%- endif -%}
    # statistics
    motion_detected_ago_${MOTION_CAMERA}_mean:
      friendly_name: ${MOTION_CAMERA} detected ago avg
      entity_id:
        - sensor.motion_detected_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics != none %}
          {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.state|int is number %}
            {{ states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.state|float }}
          {%- else -%}null{%- endif -%}
        {%- else -%}null{%- endif -%}
    motion_detected_ago_${MOTION_CAMERA}_min_value:
      friendly_name: ${MOTION_CAMERA} detected ago min
      entity_id:
        - sensor.motion_detected_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_ago_${MOTION_CAMERA}_max_value:
      friendly_name: ${MOTION_CAMERA} detected ago max
      entity_id:
        - sensor.motion_detected_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_ago_${MOTION_CAMERA}_stdev:
      friendly_name: ${MOTION_CAMERA} detected ago stdev
      entity_id:
        - sensor.motion_detected_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_detected_ago_${MOTION_CAMERA}_change_rate:
      friendly_name: ${MOTION_CAMERA} ago change
      entity_id:
        - sensor.motion_detected_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_ago_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}

# statistics
- platform: statistics
  name: motion_detected_ago_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_detected_ago_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24
- platform: statistics
  name: motion_detected_ago_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_detected_ago_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

###
## detected_entity
###

## status
- platform: template
  sensors:
    motion_detected_entity_status_${MOTION_CAMERA}:
      friendly_name: Found_${MOTION_CAMERA}
      entity_id:
        - counter.motion_detected_entity_counter_${MOTION_CAMERA}
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}
        - sensor.motion_detected_entity_device_${MOTION_CAMERA}
        - sensor.motion_detected_entity_camera_${MOTION_CAMERA}
        - sensor.motion_detected_entity_when_${MOTION_CAMERA}
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}
      value_template: >-
        {% set count = states('sensor.motion_detected_entity_count_${MOTION_CAMERA}')|int %}
        {% set device = states('sensor.motion_detected_entity_device_${MOTION_CAMERA}') %}
        {% set camera = states('sensor.motion_detected_entity_camera_${MOTION_CAMERA}') %}
        {% set ago = states('sensor.motion_detected_entity_ago_${MOTION_CAMERA}') %}
        {% set when = states('sensor.motion_detected_entity_when_${MOTION_CAMERA}') %}
        {% if count > 0 %} {{ count }} {% else %}zero{% endif %} {{ states('sensor.motion_detect_entity') -}}(s);
        {{ device -}}/{{- camera }};
        {{ when }}; {{ ago }} second(s) ago

## timing
- platform: template
  sensors:
    motion_detected_entity_date_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_detected_entity_counter_${MOTION_CAMERA}
      unit_of_measurement: seconds
      value_template: >-
        {% set date = states('sensor.motion_annotated_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %}{{ date }} {% else %}null{% endif %}
    # human readable
    motion_detected_entity_when_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} identified at
      entity_id:
        - sensor.motion_detected_entity_date_${MOTION_CAMERA}
      value_template: >-
        {% set date = states('sensor.motion_detected_entity_date_${MOTION_CAMERA}')|int %}
        {% if date > 0 %} {{ date|timestamp_custom("%a %b %d ~ %I:%M %p") }} {% else %}never{% endif %}

## counting
- platform: template
  sensors:
    motion_detected_entity_counter_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected entity counter
      entity_id:
        - counter.motion_detected_entity_counter_${MOTION_CAMERA}
      unit_of_measurement: count
      value_template: >
        {% if states('counter.motion_detected_entity_counter_${MOTION_CAMERA}') != 'unknown' %}
          {{ states('counter.motion_detected_entity_counter_${MOTION_CAMERA}')|int }}
        {%- else -%}null{%- endif -%}

## ago
- platform: template
  sensors:
    motion_detected_entity_ago_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} detected entity ago
      entity_id:
        - sensor.motion_detected_entity_date_${MOTION_CAMERA}
        - sun.sun
      unit_of_measurement: seconds
      value_template: >
          {% if states.sensor.motion_detected_entity_date_${MOTION_CAMERA} != none
                and states.sensor.motion_detected_entity_date_${MOTION_CAMERA}.state|int > 0 %}
            {{ (now().timestamp()|int) - (states.sensor.motion_detected_entity_date_${MOTION_CAMERA}.state|int) }}
          {%- else -%}null{%- endif -%}
    # statistics
    motion_detected_entity_ago_${MOTION_CAMERA}_mean:
      friendly_name: ${MOTION_CAMERA} detected entity ago avg
      entity_id:
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics != none %}
          {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.state|int is number %}
            {{ states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.state|float }}
          {%- else -%}null{%- endif -%}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_ago_${MOTION_CAMERA}_min_value:
      friendly_name: ${MOTION_CAMERA} detected entity ago min
      entity_id:
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_ago_${MOTION_CAMERA}_max_value:
      friendly_name: ${MOTION_CAMERA} detected entity ago max
      entity_id:
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >-
        {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_ago_${MOTION_CAMERA}_stdev:
      friendly_name: ${MOTION_CAMERA} detected entity ago stdev
      entity_id:
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_ago_${MOTION_CAMERA}_change_rate:
      friendly_name: ${MOTION_CAMERA} detected entity ago change
      entity_id:
        - sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics
      unit_of_measurement: seconds
      value_template: >
        {% if states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics != none %}
          {{ states.sensor.motion_detected_entity_ago_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}
# statistics
- platform: statistics
  name: motion_detected_entity_ago_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_detected_entity_ago_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24
- platform: statistics
  name: motion_detected_entity_ago_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_detected_entity_ago_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

## count
- platform: template
  sensors:
    # count based on loop
    motion_detected_entity_count_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} identified
      entity_id:
        - sensor.motion_detected_entity_loop_${MOTION_CAMERA}
      unit_of_measurement: entities
      # use loop count or zero
      value_template: >-
        {% if states.sensor.motion_detected_entity_loop_${MOTION_CAMERA} != none
              and states.sensor.motion_detected_entity_loop_${MOTION_CAMERA}.state != 'null' %}
          {{ states.sensor.motion_detected_entity_loop_${MOTION_CAMERA}.state|int }}
        {% else %}null{% endif %}
    # loop
    motion_detected_entity_loop_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_event_annotated
      value_template: >-
        {% if states.sensor.motion_event_annotated_${MOTION_CAMERA} != none
              and state_attr('sensor.motion_event_annotated_${MOTION_CAMERA}','count') != none
              and states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.count|int > 0 %}
          {% for detected in states.sensor.motion_event_annotated_${MOTION_CAMERA}.attributes.detected %}
            {% if detected.entity == states.sensor.motion_detect_entity.state and detected.count|int > 0 %}
              {{ detected.count }}
            {% endif %}
          {% endfor %}
        {% else %}0{% endif %}
    # statistics
    motion_detected_entity_count_mean_${MOTION_CAMERA}:
      friendly_name: ${MOTION_CAMERA} identified avg
      entity_id:
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics
      unit_of_measurement: entities
      value_template: >-
        {% if states('sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics.state|float }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_count_${MOTION_CAMERA}_min_value:
      friendly_name: ${MOTION_CAMERA} identified min
      entity_id:
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics
      unit_of_measurement: entities
      value_template: >-
        {% if states('sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics.attributes.min_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_count_${MOTION_CAMERA}_max_value:
      friendly_name: ${MOTION_CAMERA} identified max
      entity_id:
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics
      unit_of_measurement: entities
      value_template: >-
        {% if states('sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics.attributes.max_value|int }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_count_${MOTION_CAMERA}_stdev:
      friendly_name: ${MOTION_CAMERA} identified stdev
      entity_id:
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics
      unit_of_measurement: entities
      value_template: >
        {% if states('sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics.attributes.standard_deviation|float }}
        {%- else -%}null{%- endif -%}
    motion_detected_entity_count_${MOTION_CAMERA}_change_rate:
      friendly_name: ${MOTION_CAMERA} identified change
      entity_id:
        - sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics
      unit_of_measurement: entities
      value_template: >
        {% if states('sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics') != 'unknown' %}
          {{ states.sensor.motion_detected_entity_count_${MOTION_CAMERA}_statistics.attributes.change_rate|float }}
        {%- else -%}null{%- endif -%}

# statistics
- platform: statistics
  name: motion_detected_entity_count_${MOTION_CAMERA}_statistics
  entity_id: sensor.motion_detected_entity_count_${MOTION_CAMERA}
  sampling_size: 100
  max_age:
    hours: 24
- platform: statistics
  name: motion_detected_entity_count_${MOTION_CAMERA}_stdev_statistics
  entity_id: sensor.motion_detected_entity_count_${MOTION_CAMERA}_stdev
  sampling_size: 100
  max_age:
    hours: 24

###
# picture
###

- platform: template
  sensors:
    motion_end_picture_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_end_counter_${MOTION_CAMERA}
      value_template: >-
        {% set bu = states('sensor.motion_base_url') %}
        {% if bu != 'unknown' %}
          {% if states('input_boolean.motion_snapshot') == 'on' %}
            {{ bu + '/local/images/motion_end-${MOTION_CAMERA}.jpg' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_end_${MOTION_CAMERA}','entity_picture') %}
            {% if ep != 'unknown' and ep != 'null' and ep|length > 0 %}
              {{ bu + ep }}
            {% else %}
              {{ states('sensor.motion_nosignal_picture') }}
            {% endif %}
          {% endif %}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_annotated_picture_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_annotated_counter_${MOTION_CAMERA}
      value_template: >-
        {% set bu = states('sensor.motion_base_url') %}
        {% if bu != 'unknown' %}
          {% if states('input_boolean.motion_snapshot') == 'on' %}
            {{ bu + '/local/images/motion_annotated-${MOTION_CAMERA}.jpg' }}
          {% else %}
            {% set ep = state_attr('camera.motion_event_annotated_${MOTION_CAMERA}','entity_picture') %}
            {% if ep != 'unknown' and ep != 'null' and ep|length > 0 %}
              {{ bu + ep }}
            {% else %}
              {{ states('sensor.motion_nosignal_picture') }}
            {% endif %}
          {% endif %}
        {% else %}null{% endif %}

- platform: template
  sensors:
    motion_detected_picture_${MOTION_CAMERA}:
      entity_id:
        - sensor.motion_detected_counter_${MOTION_CAMERA}
      value_template: >-
        {% if states('input_boolean.motion_snapshot') == 'on' %}
          {% set bu = states('sensor.motion_base_url') %}
          {% if bu != none and bu != 'unknown' and bu != 'null' and bu|length > 0 %}
            {% set s = bu + '/local/images/motion_detected-${MOTION_CAMERA}.jpg' %}
          {% endif %}
        {% else %}
          {% set s = states('sensor.motion_annotated_picture_${MOTION_CAMERA}') %}
        {% endif %}
        {% if s is defined and s != none and s != 'unknown' and s != 'null' and s|length > 0 %}
          {{ s }}
        {% else %}
          {{ states('sensor.motion_nosignal_picture') }}
        {% endif %}

- platform: template
  sensors:
    motion_detected_entity_picture_${MOTION_CAMERA}:
      friendly_name: Detected entity picture
      entity_id:
        - sensor.motion_detected_entity_counter_${MOTION_CAMERA}
      value_template: >-
        {% if states('input_boolean.motion_snapshot') == 'on' %}
          {% set bu = states('sensor.motion_base_url') %}
          {% if bu != none and bu != 'unknown' and bu != 'null' and bu|length > 0 %}
            {% set s = bu + '/local/images/motion_detected_entity-${MOTION_CAMERA}.jpg' %}
          {% endif %}
        {% else %}
          {% set s = states('sensor.motion_annotated_picture_${MOTION_CAMERA}') %}
        {% endif %}
        {% if s is defined and s != none and s != 'unknown' and s != 'null' and s|length > 0 %}
          {{ s }}
        {% else %}
          {{ states('sensor.motion_nosignal_picture') }}
        {% endif %}

###
# complete
###

- platform: template
  sensors:
    motion_complete_${MOTION_CAMERA}:
      unit_of_measurement: seconds
      entity_id:
        - camera.motion_event_annotated_${MOTION_CAMERA}
        - sensor.motion_event_annotated_${MOTION_CAMERA}
      value_template: >
        {% set c = as_timestamp(states.camera.motion_event_annotated_${MOTION_CAMERA}.last_updated) %}
        {% set s = as_timestamp(states.sensor.motion_event_annotated_${MOTION_CAMERA}.last_updated) %}
        {{  c|float - s|float }}
